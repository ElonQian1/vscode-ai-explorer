# 文件树蓝图功能 - 快速开始指南

## 🎉 集成完成！

文件树蓝图模块已成功集成到你的 AI Explorer 项目中。

---

## 📁 新增文件结构

```
src/features/filetree-blueprint/
├── FileTreeBlueprintModule.ts          # 模块入口
├── module.json                          # 模块配置
├── README.md                            # 模块文档
├── app/
│   └── usecases/
│       └── GenerateBlueprintUseCase.ts # 生成蓝图用例
├── domain/
│   └── FileTreeScanner.ts              # 文件树扫描器
└── panel/
    └── BlueprintPanel.ts               # Webview 面板

media/filetree-blueprint/
├── index.css                            # 蓝图样式
└── graphView.js                         # 前端交互逻辑
```

---

## 🚀 使用方式

### 方式 1：从资源管理器右键
1. 在 VS Code 资源管理器中，右键点击任意**文件**或**文件夹**
2. 选择 **"在此打开蓝图"**
3. 自动扫描并显示文件树蓝图

### 方式 2：从命令面板
1. 按 `Ctrl+Shift+P` (Windows) 或 `Cmd+Shift+P` (Mac)
2. 输入 `生成文件树蓝图`
3. 选择要扫描的工作区文件夹

### 方式 3：从 AI 资源管理器
1. 打开左侧的 **AI 资源管理器** 视图
2. 右键点击任意节点
3. 选择 **"在此打开蓝图"**

### 方式 4：打开自定义 JSON 架构图
1. 打开一个 `.json` 文件（如 `docs/可视化世界画布/example-blueprint.json`）
2. 按 `Ctrl+Shift+P`
3. 输入 `打开工作流图`
4. 查看自定义架构图

---

## 🎨 蓝图功能

### 交互操作
- **拖拽画布**：鼠标左键按住空白处拖动
- **缩放**：鼠标滚轮 或 工具栏的 `放大/缩小` 按钮
- **选择节点**：单击节点
- **双击文件夹**：进入子层级（重新扫描该文件夹）
- **双击文件**：在编辑器中打开文件

### 工具栏功能
- **重置视图**：恢复到初始位置和缩放比例
- **适应窗口**：自动调整大小以显示所有节点
- **放大/缩小**：手动调整缩放级别
- **节点/边统计**：显示当前图表的节点和边数量

### 节点类型
- 📁 **文件夹**（黄色）：可以双击进入子层级
- 📄 **文件**（蓝色）：可以双击打开
- 🔷 **模块**（青色）：自定义模块节点

---

## 🧪 测试步骤

### 1. 测试文件树扫描
```bash
# 1. 在资源管理器中右键点击 src 文件夹
# 2. 选择 "在此打开蓝图"
# 3. 查看生成的文件树蓝图
```

### 2. 测试自定义 JSON
```bash
# 1. 打开文件: docs/可视化世界画布/example-blueprint.json
# 2. 按 Ctrl+Shift+P
# 3. 输入: 打开工作流图
# 4. 查看示例架构图
```

### 3. 测试双击下钻
```bash
# 1. 在蓝图中找到一个文件夹节点（黄色）
# 2. 双击该节点
# 3. 观察是否重新扫描并显示该文件夹的子内容
```

---

## 🔧 配置和自定义

### 修改排除规则
编辑 `src/features/filetree-blueprint/domain/FileTreeScanner.ts`：

```typescript
const DEFAULT_EXCLUDES = [
    '**/.git/**',
    '**/node_modules/**',
    '**/dist/**',
    '**/out/**',
    // 添加你的排除规则...
];
```

### 修改节点样式
编辑 `media/filetree-blueprint/index.css`：

```css
.node-folder rect {
    fill: var(--folder-color);  /* 修改文件夹颜色 */
}

.node-file rect {
    fill: var(--file-color);    /* 修改文件颜色 */
}
```

### 自定义布局算法
编辑 `FileTreeScanner.ts` 中的 `calculatePosition` 方法：

```typescript
private calculatePosition(index: number, depth: number): Position {
    // 实现你自己的布局算法
    // 例如：树形布局、圆形布局、力导向布局等
}
```

---

## 📊 数据格式说明

### Graph 结构
```typescript
{
  id: string;              // 图表唯一标识
  title: string;           // 图表标题
  nodes: Node[];           // 节点列表
  edges: Edge[];           // 边列表
  metadata?: any;          // 元数据
}
```

### Node 结构
```typescript
{
  id: string;              // 节点唯一标识（通常是文件路径）
  label: string;           // 节点显示文本
  type?: 'folder'|'file'|'module';  // 节点类型
  position: { x: number; y: number }; // 节点位置
  data?: Record<string, any>;         // 附加数据
}
```

### Edge 结构
```typescript
{
  id: string;              // 边唯一标识
  label?: string;          // 边标签（可选）
  from: { node: string };  // 起始节点 ID
  to: { node: string };    // 目标节点 ID
  data?: Record<string, any>; // 附加数据
}
```

---

## 🔍 调试和日志

### 查看日志
1. 按 `Ctrl+Shift+U` 打开输出面板
2. 从下拉菜单选择 **"AI-Explorer"**
3. 查看模块日志输出

### 常见问题

**Q: 蓝图面板不显示？**
- 检查控制台是否有错误
- 确保 `media/filetree-blueprint/` 文件夹存在
- 重新编译项目：`npm run compile`

**Q: 右键菜单没有"在此打开蓝图"？**
- 检查 `package.json` 中的菜单配置
- 重新加载窗口：`Ctrl+Shift+P` → `Reload Window`

**Q: 双击文件夹没反应？**
- 检查浏览器控制台（F12）的错误
- 确保文件夹路径正确

**Q: 节点位置重叠？**
- 点击工具栏的 **"适应窗口"** 按钮
- 或者自定义 `calculatePosition` 方法改进布局

---

## 🚀 下一步功能扩展

### 推荐增强功能
1. **依赖分析**：扫描 import/require 语句，生成依赖边
2. **布局算法**：集成 d3-force 或 ELK 实现自动布局
3. **搜索和过滤**：添加节点搜索、类型过滤功能
4. **导出功能**：导出为 PNG/SVG 图片或 JSON 数据
5. **缓存机制**：缓存扫描结果，提升大型项目性能
6. **React Flow 集成**：使用 React Flow 替换 SVG 实现更强大的交互

### 与现有模块集成
1. **与 UML-Canvas 联动**：点击文件节点 → 生成 UML 类图
2. **与 Explorer-Alias 联动**：显示文件的中文别名
3. **AI 分析**：调用 AI 分析项目架构，自动标注模块关系

---

## 📝 相关文档

- [模块架构说明](../ARCHITECTURE.md)
- [模块详细配置](./module.json)
- [开发指南](../CONTRIBUTING.md)

---

## ✅ 完成检查清单

- [x] 创建模块目录结构
- [x] 实现文件树扫描器
- [x] 实现 Webview 面板
- [x] 实现用例层
- [x] 创建前端资源（CSS/JS）
- [x] 更新 package.json
- [x] 注册模块到主入口
- [x] 更新工作区配置
- [x] 编译通过
- [ ] 功能测试
- [ ] 文档完善

---

**🎊 恭喜！文件树蓝图功能已成功集成！**

现在你可以按 `F5` 启动调试，测试新功能了！
