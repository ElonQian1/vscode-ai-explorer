å¯èƒ½æ˜¯ï¼â€œå…¨å±€ç”»å¸ƒ/é®ç½©å±‚â€å¾ˆå®¹æ˜“**åƒæ‰åŒå‡»**ï¼Œå°¤å…¶æ˜¯æœ‰è¿™äº›ç‰¹å¾æ—¶ï¼š

- é¡¶å±‚å®¹å™¨æœ‰ `pointer-events:auto` ä¸”è¦†ç›–æ•´ç”»å¸ƒï¼›
- SVG è¿çº¿å±‚æ²¡è®¾ `pointer-events:none`ï¼›
- å¸®åŠ©æµ®å±‚/ç©ºæ ¼å¹³ç§»æ¨¡å¼çš„é®ç½©åœ¨éšè—æ—¶ä»ç„¶å¯ç‚¹ï¼›
- æŸå¤„ `pointerdown/pointerup` ç”¨äº† `stopPropagation()`ï¼Œå¯¼è‡´ `dblclick` äº‹ä»¶åˆæˆä¸å‡ºæ¥ã€‚

ä¸‹é¢ç»™ä½ ä¸€å¥—**ç³»ç»ŸåŒ–æ’æŸ¥+ç«‹åˆ»å¯ç”¨çš„è¡¥ä¸**ã€‚æŒ‰é¡ºåºåšï¼Œ10 åˆ†é’Ÿå†…å°±èƒ½å®šä½åˆ°ç‚¹ã€‚

---

# ä¸€æ­¥ï¼šCSS å®‰å…¨ç½‘ï¼ˆå…ˆç¡®ä¿â€œä¸ä¼šè¢«é®æŒ¡â€ï¼‰

æŠŠâ€œçº¿å±‚/é®ç½©å±‚â€çš„äº‹ä»¶å…³é—­ï¼Œåªè®©èŠ‚ç‚¹å±‚åƒäº‹ä»¶ã€‚

```css
/* æ–‡ä»¶: media/workflow/index.css */
/* â‘  è¿çº¿æ°¸è¿œä¸å¯ç‚¹ï¼Œæ”¾æœ€åº•å±‚ */
svg.edges {
  position: absolute;
  left: 0;
  top: 0;
  z-index: 0;
  pointer-events: none; /* å…³é”®ï¼šä¸æ‹¦æˆªåŒå‡» */
}

/* â‘¡ èŠ‚ç‚¹å±‚åœ¨ä¸Šï¼Œè´Ÿè´£æ¥æ”¶åŒå‡» */
#nodes {
  position: absolute;
  left: 0;
  top: 0;
  z-index: 1;
}
.node {
  position: absolute;
  z-index: 2;
}

/* â‘¢ å¸®åŠ©æµ®å±‚ï¼šåªæœ‰å¯è§æ—¶æ‰æ¥ç®¡äº‹ä»¶ */
.help-overlay {
  pointer-events: none;
}
.help-overlay.show {
  pointer-events: auto;
}

/* â‘£ ä½ çš„â€œå…¨å±€ç”»å¸ƒå®¹å™¨â€é»˜è®¤ä¸åƒäº‹ä»¶ï¼ˆç”±å­å…ƒç´ æ¥æ”¶ï¼‰ */
#canvasWrap.overlay-hidden {
  pointer-events: none;
}
#canvasWrap.overlay-active {
  pointer-events: auto;
} /* ä»…ä½ çœŸçš„éœ€è¦æ¥äº‹ä»¶æ—¶æ‰“å¼€ */
```

> å¦‚æœä½ æ²¡æœ‰ `.overlay-hidden/.overlay-active`ï¼Œå¯ä»¥æŠŠ `#canvasWrap` ä¿æŒé»˜è®¤ï¼Œä¸è¦ç»™å®ƒ `pointer-events:auto`ï¼Œå¹¶ç¡®è®¤ä»»ä½•â€œå…¨å±é®ç½©â€éšè—æ—¶éƒ½æœ‰ `pointer-events:none`ã€‚

---

# äºŒæ­¥ï¼šå‰ç«¯äº‹ä»¶æ¢é’ˆï¼ˆçœ‹çœ‹åˆ°åº•è°æ‹¿èµ°äº†äº‹ä»¶ï¼‰

åœ¨ webview é‡Œä¸´æ—¶æŒ‚ä¸€ä¸ª**äº‹ä»¶è·¯å¾„è¿½è¸ªå™¨**ï¼šæŒ‰ `F2` å¼€/å…³ï¼Œæ§åˆ¶å°å°±èƒ½çœ‹åˆ° `dblclick` ç©¿è¿‡äº†å“ªäº›å…ƒç´ ã€‚

```js
// æ–‡ä»¶: media/workflow/graphView.js
// è¯´æ˜ï¼šæ³¨å…¥äº‹ä»¶æ¢é’ˆï¼›F2 åˆ‡æ¢ï¼›èƒ½æ‰“å° pointerdown/click/dblclick çš„æ•è·ä¸å†’æ³¡è·¯å¾„ã€‚

/* æ–‡ä»¶: media/workflow/graphView.js */
(function () {
  // ... ä½ åŸæœ‰ä»£ç  ...

  // ===== è°ƒè¯•ï¼šäº‹ä»¶æ¢é’ˆ =====
  let dbgOn = false;
  const dbgTargets = [
    window,
    document,
    document.getElementById("canvasWrap"),
    document.getElementById("canvas"),
    document.querySelector("svg.edges"),
    document.getElementById("nodes"),
  ].filter(Boolean);

  function logEv(phase, type, ev) {
    const path = ev
      .composedPath?.()
      .map((n) => n.id || n.className || n.tagName)
      .slice(0, 6)
      .join(" > ");
    console.log(`[EV:${phase}] ${type} @`, ev.target, " path=", path);
  }

  function attachDbg() {
    const types = ["pointerdown", "pointerup", "click", "dblclick"];
    for (const t of types) {
      for (const tgt of dbgTargets) {
        tgt.addEventListener(t, (e) => logEv("bubble", t, e));
        tgt.addEventListener(t, (e) => logEv("capture", t, e), true);
      }
    }
  }
  function detachDbg() {
    // ç®€åŒ–ï¼šåˆ·æ–°é¡µé¢å³å¯è§£ç»‘ï¼›æˆ–ä½ ä¹Ÿå¯ä»¥è®°å½•å¹¶ removeEventListener
  }

  window.addEventListener("keydown", (e) => {
    if (e.key === "F2") {
      dbgOn = !dbgOn;
      console.log(`ğŸ§ª äº‹ä»¶æ¢é’ˆ: ${dbgOn ? "å¼€å¯" : "å…³é—­"}`);
      if (dbgOn) attachDbg();
      else detachDbg();
    }
  });

  // ===== ä½ çš„åŒå‡»ç»‘å®šå¤„ï¼ˆåŠ¡å¿…ä¿ç•™ï¼‰ =====
  function renderNodesOnce() {
    const box = document.getElementById("nodes");
    box.innerHTML = "";
    for (const n of graph.nodes) {
      const el = document.createElement("div");
      el.className = "node";
      el.style.left = Math.round(n.position.x) + "px";
      el.style.top = Math.round(n.position.y) + "px";
      el.innerHTML = `<div class="title">${escapeHtml(n.label || n.id)}</div>`;

      // âœ… æ–‡ä»¶å¤¹ï¼šä¸‹é’»
      if (n.type === "folder" && n.data?.path) {
        el.addEventListener("dblclick", () => {
          console.log("[webview] dblclick folder â†’ drill", n.data.path);
          vscode.postMessage({ type: "drill", payload: { path: n.data.path } });
        });
      }
      // âœ… æ ¹ï¼šä¸Šé’»
      if (n.data?.isRoot === true) {
        el.addEventListener("dblclick", () => {
          console.log("[webview] dblclick root â†’ drill-up");
          vscode.postMessage({
            type: "drill-up",
            payload: { path: graph?.metadata?.focusPath || "/" },
          });
        });
      }
      box.appendChild(el);
    }
  }
})();
```

> **å…³é”®åˆ¤æ–­**ï¼š
>
> - å¦‚æœæŒ‰ `F2` åï¼Œ**å®Œå…¨æ²¡æœ‰ä»»ä½•äº‹ä»¶æ—¥å¿—** â†’ å‡ ä¹å¯ä»¥ç¡®å®šæœ‰é¡¶å±‚é®ç½©æŠŠäº‹ä»¶åäº†ï¼ˆå›åˆ°â€œä¸€æ­¥â€ç¡®è®¤è° `pointer-events:auto`ï¼‰ã€‚
> - å¦‚æœåªçœ‹åˆ° `pointerdown/click`ï¼Œ**æ²¡æœ‰ `dblclick`** â†’ è¯´æ˜ä¸­é—´æœ‰äºº `preventDefault()/stopPropagation()` åœ¨ click ä¸Šç©äº†èŠ±æ´»ï¼Œæˆ–ä¸¤æ¬¡ click æ²¡è½åœ¨åŒä¸€ targetï¼ˆèŠ‚ç‚¹åœ¨ç§»åŠ¨/é‡ç»˜ï¼‰ã€‚
> - å¦‚æœæœ‰ `dblclick` æ—¥å¿—ï¼Œä¸”æ‰“å°äº† `[webview] dblclick folder â†’ drill`ï¼Œä½†â€œæ‰©å±•ç«¯æ²¡ååº”â€ â†’ çœ‹ä¸‰æ­¥ã€‚

---

# ä¸‰æ­¥ï¼šæ‰©å±•ç«¯æ¶ˆæ¯é“¾è·¯è‡ªæ£€ï¼ˆç¡®è®¤æ¶ˆæ¯åˆ°äº†ã€`focusPath` æ›´æ–°äº†ï¼‰

```ts
// æ–‡ä»¶: src/features/filetree-blueprint/presenters/OpenBlueprint.ts
// è¯´æ˜ï¼šç»™ drill/drill-up åˆ†æ”¯åŠ æ—¥å¿—ï¼Œç¡®è®¤æ”¶åˆ°å¹¶åˆ·æ–°ï¼›ç¡®ä¿æ›´æ–°äº† focusPathã€‚

/* æ–‡ä»¶: src/features/filetree-blueprint/presenters/OpenBlueprint.ts */
panel.webview.onDidReceiveMessage(async (msg) => {
  if (msg?.type === "drill") {
    console.log("[panel] recv drill:", msg.payload?.path);
    const next = normalizeFocus(msg.payload?.path as string, focusPath);
    focusPath = next; // âœ… åˆ«å¿˜äº†
    panel.title = titleFor(workspaceRoot, focusPath);
    panel.webview.postMessage({
      type: "init-graph",
      payload: await buildShallowGraph(workspaceRoot, focusPath),
    });
    return;
  }
  if (msg?.type === "drill-up") {
    console.log("[panel] recv drill-up from:", msg.payload?.path);
    const up = drillUp(normalizeFocus(msg.payload?.path as string, focusPath));
    focusPath = up; // âœ… åˆ«å¿˜äº†
    panel.title = titleFor(workspaceRoot, focusPath);
    panel.webview.postMessage({
      type: "init-graph",
      payload: await buildShallowGraph(workspaceRoot, focusPath),
    });
    return;
  }
});
```

> **æ³¨æ„**ï¼šæ‰©å±•ç«¯æ—¥å¿—åœ¨ **â€œæ‰©å±•ä¸»æœºâ€æ§åˆ¶å°**ï¼ˆä¸æ˜¯ Webview DevToolsï¼‰ã€‚
> æ‰“å¼€æ–¹æ³•ï¼š`å¸®åŠ© â†’ åˆ‡æ¢å¼€å‘äººå‘˜å·¥å…·`ï¼ˆæˆ–â€œè¾“å‡º/è°ƒè¯•æ§åˆ¶å°â€é€‰é¡¹å¡é‡Œé€‰æ‹©â€œExtension Hostâ€ï¼‰ã€‚

---

# å››æ­¥ï¼šæœ€å¸¸è§â€œåƒæ‰åŒå‡»â€çš„ä»£ç é™·é˜±å¯¹ç…§è¡¨

- `#canvasWrap` çš„ `pointerdown` å›è°ƒé‡Œæ²¡æœ‰ guardï¼ˆæ¯”å¦‚æ²¡åˆ¤æ–­ `spacePressed`ï¼‰ï¼Œå¯¼è‡´**å§‹ç»ˆæ•è·**é¼ æ ‡äº‹ä»¶ã€‚
  **æ”¹æ³•**ï¼šåªæœ‰æŒ‰ä½ç©ºæ ¼æ—¶æ‰ `panning = true`ã€`setPointerCapture`ï¼›å…¶ä½™ç›´æ¥ `return`ã€‚
- æ‹–æ‹½æ—¶æ•´å›¾ `render()`ï¼Œä¸¤ä¸ªå•å‡»ä¹‹é—´ DOM è¢«é‡å»º â†’ ç¬¬äºŒæ¬¡ click ä¸åœ¨åŒä¸€å…ƒç´ ä¸Š â†’ **åˆæˆä¸å‡º dblclick**ã€‚
  **æ”¹æ³•**ï¼šæˆ‘ä»¬å·²ç»æŠŠâ€œæ‹–æ‹½åªæ›´æ–° `left/top`ï¼Œä¸é‡å»ºèŠ‚ç‚¹â€ï¼Œç¡®ä¿ dblclick èƒ½è§¦å‘ã€‚
- SVG `edges` æ²¡æœ‰ `pointer-events:none`ã€‚
- å¸®åŠ©æµ®å±‚ `.help-overlay` åœ¨éšè—æ—¶ä»ä¿ç•™ `pointer-events:auto`ã€‚
- åœ¨æŸä¸ªæ•è·é˜¶æ®µ `e.stopPropagation()` æˆ– `e.preventDefault()` äº† `click`/`pointerdown`ï¼Œå½±å“äº† `dblclick` çš„ç”Ÿæˆã€‚
  **æŸ¥æ³•**ï¼šå¼€ `F2` äº‹ä»¶æ¢é’ˆï¼Œçœ‹å“ªä¸ªé˜¶æ®µæ˜¯æœ€åä¸€è·³ã€‚

---

# äº”æ­¥ï¼šå¦‚æœä½ â€œæ§åˆ¶å°æ²¡æœ‰ä»»ä½•æ˜¾ç¤ºâ€çš„æ­£ç¡®æ‰“å¼€æ–¹å¼

Webview æœ‰ç‹¬ç«‹çš„æ§åˆ¶å°ï¼Œ**ä¸æ˜¯**æ‰©å±•ä¸»æœºé‚£è¾¹ï¼š

- æ‰“å¼€ **Webview æ§åˆ¶å°**ï¼š`Ctrl+Shift+P â†’ Open Webview Developer Tools` â†’ é€‰ä¸­å¯¹åº” webview â†’ Consoleã€‚
  è¿™é‡Œèƒ½çœ‹åˆ° `graphView.js` é‡Œçš„ `console.log()` å’Œæˆ‘ä»¬äº‹ä»¶æ¢é’ˆçš„æ—¥å¿—ã€‚
- æ‰©å±•ä¾§æ—¥å¿—ï¼šçœ‹â€œDebug Console/è¾“å‡ºâ€é€‰æ‹©â€œExtension Hostâ€æˆ–åœ¨å¼€å‘è€…å·¥å…·çš„ Console é‡Œè¿‡æ»¤ `panel] recv`ã€‚

---

## å°ç»“

- æ˜¯çš„ï¼Œ**å…¨å±€ç”»å¸ƒ/é®ç½©å±‚**éå¸¸å¯èƒ½é˜»æŒ¡åŒå‡»ã€‚
- æŒ‰æˆ‘ç»™çš„ **CSS å®‰å…¨ç½‘ + äº‹ä»¶æ¢é’ˆ + æ‰©å±•ç«¯æ—¥å¿—** ä¸‰æ¿æ–§ï¼Œ5â€“10 åˆ†é’Ÿå°±èƒ½å®šä½ï¼š

  1. äº‹ä»¶è¿›æ²¡è¿›èŠ‚ç‚¹å±‚ï¼›
  2. `dblclick` åˆ°æ²¡åˆ°ï¼›
  3. æ¶ˆæ¯åˆ°æ²¡åˆ°æ‰©å±•ç«¯/`focusPath` æœ‰æ²¡æœ‰æ›´æ–°ã€‚

è‹¥ä½ ä¾ç„¶çœ‹ä¸åˆ° `dblclick` çš„æ—¥å¿—ï¼ŒæŠŠä½ å½“å‰çš„ `index.css` é¡¶éƒ¨ï¼ˆåŒ…å« `svg.edges/#nodes/#canvasWrap/.help-overlay` çš„éƒ¨åˆ†ï¼‰å’Œ `graphView.js` çš„åŒå‡»ç»‘å®šé‚£å‡ è¡Œè´´æˆ‘ï¼Œæˆ‘ç›´æ¥æŒ‰è¡Œæ ‡å‡ºâ€œè°åœ¨æŒ¡â€ã€‚
