# ğŸ” åŒå‡»åŠŸèƒ½è¯Šæ–­å·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸ“¦ å·¥å…·æ¸…å•

1. **debug-dblclick.js** - è‡ªåŠ¨åŒ–è¯Šæ–­è„šæœ¬ï¼ˆåœ¨ Webview Console è¿è¡Œï¼‰
2. **Ctrl+Shift+D æ¢é’ˆ** - å®æ—¶äº‹ä»¶è·¯å¾„è¿½è¸ªï¼ˆå†…ç½®åœ¨ graphView.jsï¼‰
3. **æ‰©å±•ç«¯æ—¥å¿—** - BlueprintPanel æ—¥å¿—è¾“å‡º

---

## ğŸ¯ æµ‹è¯•æµç¨‹ï¼ˆ5 åˆ†é’Ÿå®Œæˆï¼‰

### ç¬¬ 1 æ­¥ï¼šé‡å¯æ‰©å±•
```
æŒ‰ F5 å¯åŠ¨è°ƒè¯•ä¼šè¯
```

### ç¬¬ 2 æ­¥ï¼šæ‰“å¼€è“å›¾è§†å›¾
1. åœ¨ VS Code ä¸­ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š`FileTree Blueprint: Show Blueprint`
2. ç­‰å¾…è“å›¾é¢æ¿åŠ è½½å®Œæˆ

### ç¬¬ 3 æ­¥ï¼šæ‰“å¼€ Webview å¼€å‘è€…å·¥å…·
1. åœ¨è“å›¾é¢æ¿ä¸­ï¼ŒæŒ‰ `Ctrl+Shift+I`ï¼ˆæˆ–å³é”® â†’ "æ£€æŸ¥å…ƒç´ "ï¼‰
2. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾é¡µ

### ç¬¬ 4 æ­¥ï¼šè¿è¡Œè‡ªåŠ¨åŒ–è¯Šæ–­
1. æ‰“å¼€æ–‡ä»¶ï¼š`media/filetree-blueprint/debug-dblclick.js`
2. **å¤åˆ¶å…¨éƒ¨å†…å®¹**ï¼ˆ85 è¡Œï¼‰
3. ç²˜è´´åˆ° Webview Console ä¸­
4. æŒ‰ **Enter** è¿è¡Œ

**é¢„æœŸè¾“å‡ºï¼š**
```
ğŸ” ===== åŒå‡»åŠŸèƒ½è¯Šæ–­æŠ¥å‘Š =====

âœ… Step 1: graph å¯¹è±¡å­˜åœ¨
   graphType = 'filetree' (æ­£ç¡®)

âœ… Step 2: æ‰¾åˆ° 15 ä¸ªèŠ‚ç‚¹ DOM
   ç¤ºä¾‹èŠ‚ç‚¹: <div class="node node-folder">...</div>

âœ… Step 3: æ‰¾åˆ° 8 ä¸ªåŒå‡»ç›‘å¬å™¨
   - 5 ä¸ªæ–‡ä»¶å¤¹èŠ‚ç‚¹ç»‘å®šæˆåŠŸ
   - 3 ä¸ªæ–‡ä»¶èŠ‚ç‚¹ç»‘å®šæˆåŠŸ

âœ… Step 4: CSS å±‚çº§æ­£ç¡®
   edges: z-index 0, pointer-events none
   nodes: z-index 1
   .node: z-index 2

âœ… è¯Šæ–­å®Œæˆï¼šåŒå‡»åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œ
```

### ç¬¬ 5 æ­¥ï¼šå¯ç”¨å®æ—¶æ¢é’ˆ
1. åœ¨è“å›¾é¢æ¿ä¸­ï¼ŒæŒ‰ **Ctrl+Shift+D**
2. æ§åˆ¶å°æ˜¾ç¤ºï¼š`ğŸ” åŒå‡»è¯Šæ–­æ¢é’ˆ: ON`
3. ç°åœ¨åŒå‡»ä»»ä½•èŠ‚ç‚¹ï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤ºå®Œæ•´äº‹ä»¶è·¯å¾„

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ” [æ¢é’ˆ] æ•è·åŒå‡»äº‹ä»¶
  ç›®æ ‡: <div class="node node-file">src/index.ts</div>
  è·¯å¾„: div.node â†’ #nodes â†’ #canvas â†’ #canvasWrap â†’ body â†’ html
  graphType: filetree âœ…
  å‘é€æ¶ˆæ¯: analyze-file
```

### ç¬¬ 6 æ­¥ï¼šæµ‹è¯•åŒå‡»åŠŸèƒ½
1. **åŒå‡»æ–‡ä»¶å¤¹** â†’ åº”è¯¥ä¸‹é’»åˆ°å­ç›®å½•
2. **åŒå‡»æ–‡ä»¶** â†’ åº”è¯¥æ˜¾ç¤ºåˆ†æå¡ç‰‡
3. **åŒå‡»æ ¹èŠ‚ç‚¹** â†’ åº”è¯¥è¿”å›ä¸Šä¸€çº§

---

## âš ï¸ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šè¯Šæ–­è„šæœ¬æ˜¾ç¤º "graph ä¸å­˜åœ¨"
**åŸå› ï¼š** Webview æœªæ­£ç¡®åˆå§‹åŒ–

**è§£å†³ï¼š**
1. æŸ¥çœ‹æ‰©å±•ç«¯æ—¥å¿—ï¼ˆè°ƒè¯•æ§åˆ¶å°ï¼‰
2. æœç´¢ `[UI] ğŸ”„ æ£€æµ‹åˆ°å·²æœ‰å›¾è¡¨æ•°æ®ï¼Œé‡æ–°å‘é€ init-graph`
3. å¦‚æœæ²¡æœ‰æ­¤æ—¥å¿—ï¼Œæ£€æŸ¥ `BlueprintPanel.handleWebviewReady()`

### é—®é¢˜ 2ï¼šè¯Šæ–­è„šæœ¬æ˜¾ç¤º "graphType ä¸åŒ¹é…"
**åŸå› ï¼š** FileTreeScanner æœªæ­£ç¡®è®¾ç½®å…ƒæ•°æ®

**è§£å†³ï¼š**
```typescript
// æ£€æŸ¥ FileTreeScanner.ts
metadata: {
    graphType: 'filetree',  // âœ… å¿…é¡»å­˜åœ¨
    workspaceRoot: targetPath,
    scanMode: 'shallow'
}
```

### é—®é¢˜ 3ï¼šè¯Šæ–­è„šæœ¬æ˜¾ç¤º "æœªæ‰¾åˆ°åŒå‡»ç›‘å¬å™¨"
**åŸå› ï¼š** renderNodesOnce() æœªæ‰§è¡Œæˆ–ç»‘å®šæ¡ä»¶ä¸æ»¡è¶³

**è§£å†³ï¼š**
1. åœ¨ Webview Console ä¸­è¿è¡Œï¼š
   ```javascript
   console.log('renderNodesOnce æ˜¯å¦è°ƒç”¨ï¼Ÿ', window.graph);
   ```
2. æ£€æŸ¥ graphView.js çš„ç»‘å®šæ¡ä»¶ï¼š
   ```javascript
   if (n.type === "file" && n.data?.path && graph?.metadata?.graphType === "filetree") {
       // è¿™é‡Œåº”è¯¥ç»‘å®šäº‹ä»¶
   }
   ```

### é—®é¢˜ 4ï¼šæ¢é’ˆæ˜¾ç¤ºäº‹ä»¶è·¯å¾„ï¼Œä½†æ²¡æœ‰å‘é€æ¶ˆæ¯
**åŸå› ï¼š** äº‹ä»¶è¢«é®ç½©æˆ–å®¹å™¨æ‹¦æˆª

**è§£å†³ï¼š**
1. æŸ¥çœ‹æ¢é’ˆè¾“å‡ºçš„äº‹ä»¶è·¯å¾„
2. æ£€æŸ¥è·¯å¾„ä¸­æ˜¯å¦æœ‰æ„å¤–çš„å…ƒç´ ï¼ˆå¦‚ overlayã€maskï¼‰
3. æ£€æŸ¥ CSS ä¸­çš„ `pointer-events` è®¾ç½®

### é—®é¢˜ 5ï¼šæ‰©å±•ç«¯æ”¶ä¸åˆ°æ¶ˆæ¯
**åŸå› ï¼š** vscode.postMessage() å¤±è´¥æˆ–æ¶ˆæ¯å¤„ç†é”™è¯¯

**è§£å†³ï¼š**
1. åœ¨ Webview Console ä¸­æµ‹è¯•ï¼š
   ```javascript
   vscode.postMessage({ type: 'test', payload: {} });
   ```
2. æŸ¥çœ‹æ‰©å±•ç«¯æ—¥å¿—ï¼Œæœç´¢ `[UI] ğŸ“¬ æ”¶åˆ°æ¶ˆæ¯`
3. æ£€æŸ¥ `BlueprintPanel.handleWebviewMessage()`

---

## ğŸ“Š è¯Šæ–­ç»“æœè§£è¯»

### âœ… å®Œå…¨æ­£å¸¸çš„è¾“å‡º
```
âœ… Step 1-6 å…¨éƒ¨é€šè¿‡
âœ… è¯Šæ–­å®Œæˆï¼šåŒå‡»åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œ
```
**è¡ŒåŠ¨ï¼š** ç›´æ¥æµ‹è¯•åŒå‡»åŠŸèƒ½ï¼Œåº”è¯¥å¯ä»¥æ­£å¸¸ä½¿ç”¨

---

### âš ï¸ éƒ¨åˆ†å¼‚å¸¸çš„è¾“å‡º

#### åœºæ™¯ Aï¼šgraph ä¸å­˜åœ¨
```
âŒ Step 1: graph æœªå®šä¹‰
```
**æ ¹å› ï¼š** init-graph æ¶ˆæ¯æœªé€è¾¾æˆ–å¤„ç†å¤±è´¥

**ä¿®å¤æ­¥éª¤ï¼š**
1. æ£€æŸ¥æ‰©å±•ç«¯æ—¥å¿—ï¼šæ˜¯å¦å‘é€äº† init-graphï¼Ÿ
2. æ£€æŸ¥ Webview æ¶ˆæ¯ç›‘å¬å™¨ï¼šæ˜¯å¦æ­£ç¡®å¤„ç†äº† init-graphï¼Ÿ
3. å°è¯•æ‰‹åŠ¨é‡æ–°å‘é€ï¼š
   ```typescript
   // BlueprintPanel.ts
   if (this.currentGraph) {
       await this.safePostMessage({ type: 'init-graph', payload: this.currentGraph });
   }
   ```

#### åœºæ™¯ Bï¼šgraphType ä¸åŒ¹é…
```
âŒ Step 1: graphType = 'other' (æœŸæœ›: 'filetree')
```
**æ ¹å› ï¼š** FileTreeScanner è®¾ç½®é”™è¯¯æˆ–è¢«è¦†ç›–

**ä¿®å¤æ­¥éª¤ï¼š**
1. æ£€æŸ¥ `FileTreeScanner.scanPath()` å’Œ `scanShallow()`
2. ç¡®ä¿è¿”å›çš„ Graph å¯¹è±¡åŒ…å«ï¼š
   ```typescript
   metadata: { graphType: 'filetree', ... }
   ```
3. æ£€æŸ¥ä¸­é—´å¤„ç†ç¯èŠ‚æ˜¯å¦ä¿®æ”¹äº† metadata

#### åœºæ™¯ Cï¼šæ²¡æœ‰åŒå‡»ç›‘å¬å™¨
```
âœ… Step 1-2: graph æ­£å¸¸ï¼ŒèŠ‚ç‚¹ DOM å­˜åœ¨
âŒ Step 3: æœªæ‰¾åˆ°ä»»ä½•åŒå‡»ç›‘å¬å™¨
```
**æ ¹å› ï¼š** renderNodesOnce() ä¸­çš„ç»‘å®šæ¡ä»¶ä¸æ»¡è¶³

**ä¿®å¤æ­¥éª¤ï¼š**
1. åœ¨ graphView.js ä¸­æ·»åŠ è¯Šæ–­æ—¥å¿—ï¼ˆå·²å­˜åœ¨ï¼‰ï¼š
   ```javascript
   console.log(`[è¯Šæ–­] æ–‡ä»¶èŠ‚ç‚¹ "${n.label}":`, {
       nodeType: n.type,
       hasPath: !!n.data?.path,
       graphType: graph?.metadata?.graphType,
       willBindDoubleClick: shouldBind
   });
   ```
2. æ£€æŸ¥è¾“å‡ºï¼Œæ‰¾å‡ºå“ªä¸ªæ¡ä»¶ä¸æ»¡è¶³
3. ä¿®å¤ç›¸åº”çš„æ•°æ®æˆ–é€»è¾‘

#### åœºæ™¯ Dï¼šCSS å±‚çº§é”™è¯¯
```
âœ… Step 1-3: graphã€DOMã€ç›‘å¬å™¨æ­£å¸¸
âŒ Step 4: edges z-index = 5 (åº”è¯¥ â‰¤ 0)
```
**æ ¹å› ï¼š** CSS å±‚çº§è®¾ç½®é”™è¯¯ï¼Œå¯¼è‡´è¿çº¿é®æŒ¡èŠ‚ç‚¹

**ä¿®å¤æ­¥éª¤ï¼š**
1. æ£€æŸ¥ `index.css` ä¸­çš„ z-index è®¾ç½®
2. ç¡®ä¿ï¼š
   ```css
   svg.edges { z-index: 0; pointer-events: none; }
   #nodes { z-index: 1; }
   .node { z-index: 2; }
   ```

---

## ğŸ› ï¸ é«˜çº§è°ƒè¯•æŠ€å·§

### æŠ€å·§ 1ï¼šæ‰‹åŠ¨è§¦å‘åŒå‡»
åœ¨ Webview Console ä¸­ï¼š
```javascript
const fileNode = document.querySelector('.node-file');
fileNode.dispatchEvent(new MouseEvent('dblclick', { bubbles: true }));
```

### æŠ€å·§ 2ï¼šæ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨
```javascript
const node = document.querySelector('.node');
getEventListeners(node); // Chrome DevTools ä¸“ç”¨
```

### æŠ€å·§ 3ï¼šæ‹¦æˆª postMessage
```javascript
const originalPost = vscode.postMessage;
vscode.postMessage = function(msg) {
    console.log('ğŸ“¤ å‘é€æ¶ˆæ¯:', msg);
    return originalPost(msg);
};
```

### æŠ€å·§ 4ï¼šå®æ—¶ç›‘æ§ graph å˜åŒ–
```javascript
let _graph = window.graph;
Object.defineProperty(window, 'graph', {
    get() { return _graph; },
    set(val) {
        console.log('ğŸ”„ graph æ›´æ–°:', val?.metadata);
        _graph = val;
    }
});
```

---

## ğŸ“ æŠ¥å‘Šæ¨¡æ¿

å¦‚æœåŒå‡»åŠŸèƒ½ä»ç„¶ä¸å·¥ä½œï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

```markdown
### ç¯å¢ƒä¿¡æ¯
- VS Code ç‰ˆæœ¬: 
- æ‰©å±•ç‰ˆæœ¬: 
- æ“ä½œç³»ç»Ÿ: 

### è¯Šæ–­ç»“æœ
**debug-dblclick.js è¾“å‡ºï¼š**
```
ï¼ˆç²˜è´´å®Œæ•´è¾“å‡ºï¼‰
```

**Ctrl+Shift+D æ¢é’ˆè¾“å‡ºï¼š**
```
ï¼ˆç²˜è´´åŒå‡»æ—¶çš„è¾“å‡ºï¼‰
```

**æ‰©å±•ç«¯æ—¥å¿—ï¼š**
```
ï¼ˆæœç´¢ "init-graph"ã€"drill"ã€"analyze-file" çš„ç›¸å…³æ—¥å¿—ï¼‰
```

### æ“ä½œæ­¥éª¤
1. æˆ‘æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œï¼Ÿ
2. é¢„æœŸç»“æœï¼Ÿ
3. å®é™…ç»“æœï¼Ÿ

### é™„åŠ ä¿¡æ¯
- æ˜¯å¦æ‰€æœ‰æ–‡ä»¶éƒ½ä¸å·¥ä½œï¼Œè¿˜æ˜¯ç‰¹å®šæ–‡ä»¶ï¼Ÿ
- æ˜¯å¦æ‰€æœ‰æ–‡ä»¶å¤¹éƒ½ä¸å·¥ä½œï¼Œè¿˜æ˜¯ç‰¹å®šæ–‡ä»¶å¤¹ï¼Ÿ
- é‡å¯æ‰©å±•åé—®é¢˜æ˜¯å¦ä¾ç„¶å­˜åœ¨ï¼Ÿ
```

---

## âœ… æˆåŠŸæ ‡å‡†

åŒå‡»åŠŸèƒ½å®Œå…¨æ­£å¸¸çš„æ ‡å¿—ï¼š

1. **âœ… è¯Šæ–­è„šæœ¬å…¨éƒ¨é€šè¿‡**
   - graph å¯¹è±¡å­˜åœ¨ä¸” graphType = 'filetree'
   - èŠ‚ç‚¹ DOM æ•°é‡ä¸ graph.nodes ä¸€è‡´
   - æ‰¾åˆ°å¯¹åº”æ•°é‡çš„åŒå‡»ç›‘å¬å™¨
   - CSS å±‚çº§æ­£ç¡®

2. **âœ… æ¢é’ˆæ˜¾ç¤ºæ­£ç¡®è·¯å¾„**
   - äº‹ä»¶è·¯å¾„ï¼š`div.node â†’ #nodes â†’ #canvas â†’ ...`
   - å‘é€æ­£ç¡®æ¶ˆæ¯ï¼šdrill / analyze-file

3. **âœ… æ‰©å±•ç«¯æ­£ç¡®å¤„ç†**
   - BlueprintPanel æ”¶åˆ°æ¶ˆæ¯
   - æ‰§è¡Œç›¸åº”é€»è¾‘ï¼ˆä¸‹é’»/åˆ†æï¼‰
   - Webview æ›´æ–°æˆåŠŸ

4. **âœ… ç”¨æˆ·ä½“éªŒæµç•…**
   - åŒå‡»æ–‡ä»¶å¤¹ â†’ ç«‹å³ä¸‹é’»
   - åŒå‡»æ–‡ä»¶ â†’ å¡ç‰‡æ˜¾ç¤º
   - åŒå‡»æ ¹èŠ‚ç‚¹ â†’ è¿”å›ä¸Šçº§

---

**Happy Debugging! ğŸ‰**
