# å³é”®èœå•è°ƒè¯•æŒ‡å—

## ğŸ¯ é¢„æœŸè¡Œä¸º
åœ¨ **AI èµ„æºç®¡ç†å™¨** ä¸­å³é”®æ–‡ä»¶å¤¹ â†’ é€‰æ‹©"åœ¨æ­¤æ‰“å¼€è“å›¾" â†’ **ç›´æ¥æ‰“å¼€è¯¥æ–‡ä»¶å¤¹çš„è“å›¾**ï¼Œä¸åº”å¼¹å‡ºæ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ã€‚

---

## âœ… å·²ä¿®å¤çš„å†…å®¹

### 1. ExplorerTreeItem.ts
```typescript
// å·²æ·»åŠ  resourceUri å±æ€§
this.resourceUri = vscode.Uri.file(this.node.path);
```

### 2. package.json
```jsonc
// å·²ä¼˜åŒ–èœå•æ¡ä»¶ï¼Œåªåœ¨æ–‡ä»¶å¤¹ä¸Šæ˜¾ç¤º
{
  "command": "filetreeBlueprint.openFromPath",
  "when": "view == aiExplorer && (viewItem == folder || viewItem == folderHasAlias)",
  "group": "navigation@17"
}
```

### 3. resolveTarget.ts
```typescript
// å·²ä¼˜åŒ–å‚æ•°æå–é€»è¾‘å¹¶æ·»åŠ è°ƒè¯•æ—¥å¿—
// ä¼˜å…ˆæ£€æŸ¥ resourceUriï¼ˆTreeItem å¯¹è±¡ï¼‰
if ((raw as any)?.resourceUri instanceof vscode.Uri) {
    uri = (raw as any).resourceUri as vscode.Uri;
    console.log('[resolveTargetToFileUri] ä» resourceUri æå–:', uri.toString());
}
```

---

## ğŸ” è°ƒè¯•æ­¥éª¤

### Step 1: é‡æ–°åŠ è½½ VS Code
1. æŒ‰ `F1` æˆ– `Ctrl+Shift+P`
2. è¾“å…¥å¹¶æ‰§è¡Œ: `Developer: Reload Window`

### Step 2: æ‰“å¼€å¼€å‘è€…å·¥å…·
1. æŒ‰ `F1` æˆ– `Ctrl+Shift+P`
2. è¾“å…¥å¹¶æ‰§è¡Œ: `Developer: Toggle Developer Tools`
3. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾

### Step 3: æµ‹è¯•å³é”®èœå•
1. åœ¨ **AI èµ„æºç®¡ç†å™¨** è§†å›¾ä¸­æ‰¾åˆ°ä»»æ„æ–‡ä»¶å¤¹
2. **å³é”®ç‚¹å‡»** æ–‡ä»¶å¤¹
3. é€‰æ‹© "**åœ¨æ­¤æ‰“å¼€è“å›¾**"
4. è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º

---

## ğŸ“Š é¢„æœŸçš„æ§åˆ¶å°æ—¥å¿—

### âœ… æˆåŠŸæƒ…å†µï¼ˆåº”è¯¥çœ‹åˆ°ï¼‰
```
[resolveTargetToFileUri] æ¥æ”¶å‚æ•°ç±»å‹: object
[resolveTargetToFileUri] å‚æ•°è¯¦æƒ…: {path: 'd:\\your-project\\some-folder', name: 'folder', type: 'directory', ...}
[resolveTargetToFileUri] path å±æ€§: d:\your-project\some-folder
[resolveTargetToFileUri] ä» FileNode.path æå–: file:///d:/your-project/some-folder
å·²è§£æç›®æ ‡: /some-folder (d:\your-project\some-folder)
```

æˆ–è€…ï¼ˆå¦‚æœä¼ é€’çš„æ˜¯ TreeItemï¼‰:
```
[resolveTargetToFileUri] æ¥æ”¶å‚æ•°ç±»å‹: object
[resolveTargetToFileUri] å‚æ•°è¯¦æƒ…: ExplorerTreeItem {...}
[resolveTargetToFileUri] resourceUri: file:///D:/your-project/some-folder
[resolveTargetToFileUri] ä» resourceUri æå–: file:///D:/your-project/some-folder
å·²è§£æç›®æ ‡: /some-folder (D:\your-project\some-folder)
```

### âŒ å¤±è´¥æƒ…å†µï¼ˆä¸åº”è¯¥çœ‹åˆ°ï¼‰
```
[resolveTargetToFileUri] æ¥æ”¶å‚æ•°ç±»å‹: undefined
[resolveTargetToFileUri] æœªæ£€æµ‹åˆ°ä»»ä½• URIï¼Œå‡†å¤‡å¼¹å‡ºé€‰æ‹©æ¡†
æœªæ£€æµ‹åˆ°æ–‡ä»¶ä¸Šä¸‹æ–‡ï¼Œè¯·é€‰æ‹©è¦ç”Ÿæˆè“å›¾çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: ä»ç„¶å¼¹å‡ºæ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†

**å¯èƒ½åŸå›  A**: æ—¢æ²¡æœ‰ resourceUri ä¹Ÿæ²¡æœ‰ path å±æ€§
```bash
# æ£€æŸ¥æ–¹æ³•ï¼šæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
# å¦‚æœçœ‹åˆ° "æœªæ£€æµ‹åˆ°ä»»ä½• URI"ï¼Œè¯´æ˜å‚æ•°æ ¼å¼ä¸å¯¹
```

**å¯èƒ½åŸå›  B**: path ä¸æ˜¯å­—ç¬¦ä¸²æˆ–ä¸æ˜¯ç»å¯¹è·¯å¾„
```bash
# æ£€æŸ¥ FileNode çš„ path å±æ€§æ˜¯å¦æ˜¯å®Œæ•´çš„ç»å¯¹è·¯å¾„
# ä¾‹å¦‚: "d:\\rust\\active-projects\\project\\folder"
```

**å¯èƒ½åŸå›  C**: èœå•æ¡ä»¶æ²¡æœ‰å‘½ä¸­
```bash
# æ£€æŸ¥æ–¹æ³•ï¼š
1. F1 â†’ "Developer: Inspect Context Keys"
2. åœ¨ AI èµ„æºç®¡ç†å™¨ä¸­ç‚¹å‡»æ–‡ä»¶å¤¹
3. æŸ¥çœ‹ï¼š
   - view = "aiExplorer" âœ…
   - viewItem = "folder" æˆ– "folderHasAlias" âœ…
```

**å¯èƒ½åŸå›  C**: å‚æ•°ä¼ é€’å¤±è´¥
```bash
# æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ä¸­çš„"æ¥æ”¶å‚æ•°ç±»å‹"å’Œ"å‚æ•°è¯¦æƒ…"
# å¦‚æœæ˜¯ undefinedï¼Œè¯´æ˜å‘½ä»¤æ²¡æœ‰æ¥æ”¶åˆ° TreeItem
```

### é—®é¢˜ 2: æ‰“å¼€äº†é”™è¯¯çš„æ–‡ä»¶å¤¹

**æ£€æŸ¥ resolveTargetToFileUri çš„æ—¥å¿—**:
- æå–çš„ URI è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Ÿ
- focusPath è®¡ç®—æ˜¯å¦æ­£ç¡®ï¼Ÿ

### é—®é¢˜ 3: èœå•é¡¹æ ¹æœ¬ä¸æ˜¾ç¤º

**æ£€æŸ¥ package.json ä¸­çš„ when æ¡ä»¶**:
```jsonc
"when": "view == aiExplorer && (viewItem == folder || viewItem == folderHasAlias)"
```

**æ£€æŸ¥ ExplorerTreeItem.ts ä¸­çš„ contextValue**:
```typescript
this.contextValue = this.node.type === 'file'
    ? (hasAlias ? 'fileHasAlias' : 'file')
    : (hasAlias ? 'folderHasAlias' : 'folder');
```

---

## ğŸ“ è‡ªæ£€æ¸…å•

- [ ] é‡æ–°åŠ è½½äº† VS Code çª—å£
- [ ] æ‰“å¼€äº†å¼€å‘è€…å·¥å…·æ§åˆ¶å°
- [ ] å³é”®ç‚¹å‡»æ–‡ä»¶å¤¹æ—¶èƒ½çœ‹åˆ°"åœ¨æ­¤æ‰“å¼€è“å›¾"èœå•é¡¹
- [ ] æ§åˆ¶å°æ˜¾ç¤ºæ­£ç¡®çš„ resourceUri æ—¥å¿—
- [ ] æ²¡æœ‰å¼¹å‡ºæ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
- [ ] è“å›¾é¢æ¿æ‰“å¼€çš„æ˜¯æ­£ç¡®çš„æ–‡ä»¶å¤¹
- [ ] é¢æ¿æ ‡é¢˜æ˜¾ç¤ºæ­£ç¡®çš„æ–‡ä»¶å¤¹å

---

## ğŸ“ æŠ€æœ¯åŸç†

### VS Code å³é”®èœå•å‚æ•°ä¼ é€’æœºåˆ¶

VS Code åœ¨è°ƒç”¨å‘½ä»¤æ—¶å¯èƒ½ä¼ é€’ä¸¤ç§ä¸åŒçš„å‚æ•°ï¼š

**æ–¹å¼ 1: ä¼ é€’ TreeItem å¯¹è±¡**
```typescript
// TreeItem æä¾› resourceUri
this.resourceUri = vscode.Uri.file(this.node.path);

// VS Code è°ƒç”¨å‘½ä»¤
vscode.commands.executeCommand('command', treeItem);

// å‘½ä»¤å¤„ç†å™¨æå–
const uri = (raw as any)?.resourceUri;
```

**æ–¹å¼ 2: ä¼ é€’åŸå§‹ Element (FileNode)**
```typescript
// VS Code æœ‰æ—¶ä¼šä¼ é€’ TreeDataProvider çš„ element
// è€Œä¸æ˜¯ getTreeItem() è¿”å›çš„ TreeItem

// FileNode å¯¹è±¡
{
  path: 'd:\\project\\folder',
  name: 'folder',
  type: 'directory',
  children: [...]
}

// å‘½ä»¤å¤„ç†å™¨éœ€è¦æå– path å±æ€§
if ((raw as any)?.path && typeof (raw as any).path === 'string') {
    const uri = vscode.Uri.file((raw as any).path);
}
```

**ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ç§æ–¹å¼ï¼Ÿ**

VS Code çš„ TreeView åœ¨ä¸åŒåœºæ™¯ä¸‹ä¼ é€’ä¸åŒçš„å‚æ•°ï¼š
- é€šè¿‡ `command` å±æ€§è§¦å‘ â†’ é€šå¸¸ä¼ é€’ TreeItem
- é€šè¿‡ `menus.view/item/context` è§¦å‘ â†’ **å¯èƒ½ä¼ é€’åŸå§‹ element**
- é€šè¿‡ä»£ç è°ƒç”¨ â†’ å–å†³äºä¼ é€’çš„å‚æ•°

**è§£å†³æ–¹æ¡ˆ**ï¼šåŒæ—¶æ”¯æŒä¸¤ç§æ ¼å¼
```typescript
// 1. ä¼˜å…ˆæ£€æŸ¥ FileNode.pathï¼ˆAI èµ„æºç®¡ç†å™¨ï¼‰
if ((raw as any)?.path && (raw as any)?.type) {
    uri = vscode.Uri.file((raw as any).path);
}
// 2. æ£€æŸ¥ TreeItem.resourceUriï¼ˆæ ‡å‡†æ–¹å¼ï¼‰
else if ((raw as any)?.resourceUri instanceof vscode.Uri) {
    uri = (raw as any).resourceUri;
}
// 3. æ£€æŸ¥ç›´æ¥ä¼ é€’çš„ Uri
else if (raw instanceof vscode.Uri) {
    uri = raw;
}
```

### ä¸ºä»€ä¹ˆéœ€è¦ viewItem æ¡ä»¶ï¼Ÿ

å¦‚æœæ²¡æœ‰ `viewItem` é™åˆ¶ï¼Œèœå•ä¼šåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ˜¾ç¤ºï¼ŒåŒ…æ‹¬ï¼š
- âŒ æ–‡ä»¶èŠ‚ç‚¹ï¼ˆæ— æ³•ç”Ÿæˆè“å›¾ï¼‰
- âŒ ç©ºç™½åŒºåŸŸï¼ˆæ²¡æœ‰ä¸Šä¸‹æ–‡ï¼‰
- âœ… æ–‡ä»¶å¤¹èŠ‚ç‚¹ï¼ˆæ­£ç¡®ï¼‰

æ·»åŠ æ¡ä»¶åï¼š
```jsonc
"when": "view == aiExplorer && (viewItem == folder || viewItem == folderHasAlias)"
```
èœå•åªåœ¨æ–‡ä»¶å¤¹èŠ‚ç‚¹ä¸Šæ˜¾ç¤ºï¼Œç¡®ä¿ä¼ é€’çš„æ˜¯æœ‰æ•ˆçš„æ–‡ä»¶å¤¹ URIã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å³é”®æ‰“å¼€ç”»é¢.md](./å³é”®æ‰“å¼€ç”»é¢.md) - åŸå§‹é—®é¢˜æè¿°ä¸è§£å†³æ–¹æ¡ˆ
- [æ–‡ä»¶å¤¹ä¸‹é’»é—®é¢˜2.md](./æ–‡ä»¶å¤¹ä¸‹é’»é—®é¢˜2.md) - æ–‡ä»¶å¤¹å¯¼èˆªé€»è¾‘
- [VS Code TreeView API](https://code.visualstudio.com/api/extension-guides/tree-view)

---

## ğŸ”„ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

è¯·æ”¶é›†ä»¥ä¸‹ä¿¡æ¯å¹¶æäº¤é—®é¢˜ï¼š

1. **æ§åˆ¶å°å®Œæ•´æ—¥å¿—** (ä» Developer Tools)
2. **ä½ å³é”®çš„æ–‡ä»¶å¤¹è·¯å¾„** (ä¾‹å¦‚: `D:\project\src\features`)
3. **æ˜¯å¦å¼¹å‡ºäº†é€‰æ‹©æ¡†** (æ˜¯/å¦)
4. **VS Code ç‰ˆæœ¬** (Help â†’ About)
5. **æ‰©å±•ç‰ˆæœ¬** (ä» package.json ä¸­çš„ version å­—æ®µ)

ç„¶ååœ¨é¡¹ç›®ä¸­åˆ›å»º Issue æˆ–åœ¨å¼€å‘è€…å·¥å…·ä¸­ç»§ç»­è°ƒè¯•ã€‚
