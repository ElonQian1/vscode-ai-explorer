# ğŸ”§ æ–‡ä»¶å¤¹ä¸‹é’»é—®é¢˜ä¿®å¤ - å®æ–½æ€»ç»“

## ğŸ› é—®é¢˜æè¿°

### é”™è¯¯æ—¥å¿—
```
[2025-10-15T18:10:43.964Z] [WARN] æœªçŸ¥æ¶ˆæ¯ç±»å‹: node-moved
[2025-10-15T18:10:44.146Z] [WARN] æœªçŸ¥æ¶ˆæ¯ç±»å‹: node-moved
```

### ç°è±¡
1. âœ— æ§åˆ¶å°ä¸æ–­è¾“å‡º"æœªçŸ¥æ¶ˆæ¯ç±»å‹: node-moved"è­¦å‘Š
2. âœ— åŒå‡»æ–‡ä»¶å¤¹è¿›è¡Œä¸‹é’»æ—¶æ²¡æœ‰ååº”
3. âœ— è·¯å¾„æ‹¼æ¥é”™è¯¯å¯¼è‡´æ— æ³•æ­£ç¡®å¯¼èˆª

---

## ğŸ“‹ é—®é¢˜åˆ†æ

### é—®é¢˜ 1: node-moved æ¶ˆæ¯æœªå¤„ç†

**æ ¹æœ¬åŸå› **ï¼š
- Webview ç«¯åœ¨æ‹–æ‹½èŠ‚ç‚¹æ—¶å‘é€ `node-moved` æ¶ˆæ¯ï¼ˆgraphView.js ç¬¬ 314 è¡Œï¼‰
- æ‰©å±•ç«¯çš„ `handleMessage` æ–¹æ³•æ²¡æœ‰ case å¤„ç†è¿™ä¸ªç±»å‹
- å¯¼è‡´è¿›å…¥ default åˆ†æ”¯ï¼Œè¾“å‡º"æœªçŸ¥æ¶ˆæ¯ç±»å‹"è­¦å‘Š

**ä»£ç è¯æ®**ï¼š
```javascript
// media/filetree-blueprint/graphView.js (ç¬¬ 311-318 è¡Œ)
el.addEventListener("pointerup", (ev) => {
    if (!dragging) return;
    // ...
    if (graph?.metadata?.graphType !== "filetree") {
        vscode.postMessage({
            type: "node-moved",  // â† å‘é€æ¶ˆæ¯
            payload: { nodeId: node.id, position: node.position },
        });
    }
});
```

```typescript
// BlueprintPanel.ts - handleMessage æ–¹æ³•
switch (message.type) {
    case 'ready': ...
    case 'node-click': ...
    case 'node-double-click': ...
    // âŒ ç¼ºå°‘ case 'node-moved'
    default:
        this.logger.warn(`æœªçŸ¥æ¶ˆæ¯ç±»å‹: ${message.type}`);  // â† è§¦å‘è­¦å‘Š
}
```

### é—®é¢˜ 2: è·¯å¾„æ‹¼æ¥é”™è¯¯å¯¼è‡´ä¸‹é’»å¤±è´¥

**æ ¹æœ¬åŸå› **ï¼š
- èŠ‚ç‚¹çš„ `data.path` å­˜å‚¨çš„å·²ç»æ˜¯**ç»å¯¹è·¯å¾„**ï¼ˆå¦‚ `D:\rust\active-projects\å°çº¢ä¹¦\employeeGUI\debug`ï¼‰
- ä¸‹é’»å¤„ç†æ—¶åˆç”¨ `path.join(workspaceRoot, folderPath)` æ‹¼æ¥
- å¯¼è‡´è·¯å¾„é‡å¤ï¼š`D:\rust\active-projects\å°çº¢ä¹¦\employeeGUI\D:\rust\active-projects\å°çº¢ä¹¦\employeeGUI\debug`

**ä»£ç è¯æ®**ï¼š
```typescript
// FileTreeScanner.ts (ç¬¬ 192 è¡Œ)
const node: Node = {
    id: nodeId,
    label: name,
    type: isDirectory ? 'folder' : 'file',
    position: { x: 0, y: 0 },
    data: {
        path: childPath,  // â† childPath æ˜¯ç»å¯¹è·¯å¾„ï¼
        parentPath: dirUri.fsPath,
        extension: isDirectory ? undefined : path.extname(name)
    }
};
```

```typescript
// BlueprintPanel.ts - handleNodeDoubleClick (åŸä»£ç  - é”™è¯¯)
const folderPath = nodeData.data.path;  // å·²ç»æ˜¯ç»å¯¹è·¯å¾„
const workspaceRoot = this.currentGraph?.metadata?.workspaceRoot;
const fullPath = path.join(workspaceRoot, folderPath);  // âŒ é”™è¯¯æ‹¼æ¥ï¼
```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ 1: æ·»åŠ  node-moved æ¶ˆæ¯å¤„ç†

**æ–‡ä»¶**ï¼š`src/features/filetree-blueprint/panel/BlueprintPanel.ts`

```typescript
case 'go-up':
    await this.handleGoUpDirectory(message.payload.currentPath);
    break;

// âœ… æ–°å¢ï¼šå¤„ç† node-moved æ¶ˆæ¯
case 'node-moved':
    // å¤„ç†èŠ‚ç‚¹ç§»åŠ¨ï¼ˆæ‰‹å†™å›¾ç­‰åœºæ™¯ï¼‰
    // å¯¹äºæ–‡ä»¶æ ‘è“å›¾ï¼Œè¿™ä¸ªæ¶ˆæ¯é€šå¸¸ä¸éœ€è¦å¤„ç†
    this.logger.debug(`èŠ‚ç‚¹ç§»åŠ¨: ${message.payload.nodeId}`, message.payload.position);
    break;

case 'error':
    this.logger.error('Webview é”™è¯¯:', message.payload);
    vscode.window.showErrorMessage(`è“å›¾é”™è¯¯: ${message.payload.message}`);
    break;
```

**è¯´æ˜**ï¼š
- æ·»åŠ  case 'node-moved' åˆ†æ”¯ï¼Œé¿å…"æœªçŸ¥æ¶ˆæ¯ç±»å‹"è­¦å‘Š
- è®°å½•è°ƒè¯•æ—¥å¿—ï¼Œä¾¿äºè¿½è¸ª
- å¯¹äºæ–‡ä»¶æ ‘è“å›¾ï¼Œä¸éœ€è¦ç‰¹æ®Šå¤„ç†ï¼ˆèŠ‚ç‚¹ä½ç½®å·²åœ¨å‰ç«¯ç®¡ç†ï¼‰

### ä¿®å¤ 2: ç§»é™¤é”™è¯¯çš„è·¯å¾„æ‹¼æ¥

**æ–‡ä»¶**ï¼š`src/features/filetree-blueprint/panel/BlueprintPanel.ts`

```typescript
// âœ… ä¿®å¤åçš„ä»£ç 
private async handleNodeDoubleClick(nodeData: any): Promise<void> {
    this.logger.info(`èŠ‚ç‚¹è¢«åŒå‡»: ${nodeData.label} (${nodeData.type})`);

    if (nodeData.type === 'folder' && nodeData.data?.path) {
        // å¦‚æœæ˜¯æ ¹èŠ‚ç‚¹ï¼Œæç¤ºç”¨æˆ·
        if (nodeData.data?.isRoot) {
            vscode.window.showInformationMessage(...);
            return;
        }
        
        // âœ… data.path å·²ç»æ˜¯å®Œæ•´çš„ç»å¯¹è·¯å¾„ï¼Œç›´æ¥ä½¿ç”¨
        const folderPath = nodeData.data.path;
        
        this.logger.info(`ä¸‹é’»åˆ°: ${folderPath}`);
        
        // âœ… ç›´æ¥ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œä¸éœ€è¦æ‹¼æ¥
        vscode.commands.executeCommand(
            'filetreeBlueprint.openFromPath',
            vscode.Uri.file(folderPath)
        );
        
    } else if (nodeData.type === 'file' && nodeData.data?.path) {
        await this.openFile(nodeData.data.path);
    }
}
```

**å…³é”®æ”¹è¿›**ï¼š
- âŒ ç§»é™¤ï¼š`path.join(workspaceRoot, folderPath)` é”™è¯¯æ‹¼æ¥
- âœ… ç›´æ¥ä½¿ç”¨ï¼š`nodeData.data.path`ï¼ˆå·²ç»æ˜¯ç»å¯¹è·¯å¾„ï¼‰
- âœ… ç®€åŒ–é€»è¾‘ï¼šä¸å†éœ€è¦è·å– workspaceRoot

---

## ğŸ“Š æ–‡æ¡£å¯¹æ¯”

### ã€Šæ–‡ä»¶å¤¹ä¸‹é’»é—®é¢˜.mdã€‹å»ºè®®ç¬¦åˆåº¦ï¼š**80%**

| æ–‡æ¡£å»ºè®® | å®æ–½çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|
| å¤„ç† node-moved æ¶ˆæ¯ | âœ… å·²å®ç° | æ·»åŠ  case åˆ†æ”¯ï¼Œè®°å½•æ—¥å¿— |
| ä¿®å¤è·¯å¾„æ‹¼æ¥é—®é¢˜ | âœ… å·²å®ç° | ç§»é™¤é”™è¯¯çš„ path.join |
| å‘é€ç›¸å¯¹è·¯å¾„ | âŒ æœªé‡‡ç”¨ | å½“å‰æ–¹æ¡ˆæ›´ç®€å•ï¼šç›´æ¥ç”¨ç»å¯¹è·¯å¾„ |
| æ‰©å±•ç«¯æ‹¼æ¥è·¯å¾„ | âŒ ä¸éœ€è¦ | èŠ‚ç‚¹å·²å­˜å‚¨ç»å¯¹è·¯å¾„ |

**ä¸ºä»€ä¹ˆä¸å®Œå…¨æŒ‰æ–‡æ¡£å®æ–½ï¼Ÿ**

æ–‡æ¡£å»ºè®®ï¼š
```javascript
// Webview å‘é€ç›¸å¯¹è·¯å¾„
const relativePath = path.replace(workspaceRootPath, '');
vscode.postMessage({ type: 'drill', payload: { path: relativePath } });
```

```typescript
// æ‰©å±•ç«¯æ‹¼æ¥
const focusUri = vscode.Uri.joinPath(workspaceRoot, relativePath);
```

**å½“å‰æ–¹æ¡ˆæ›´ä¼˜**ï¼š
- âœ… èŠ‚ç‚¹æ•°æ®ç”Ÿæˆæ—¶å·²è®¡ç®—ç»å¯¹è·¯å¾„ï¼ˆFileTreeScannerï¼‰
- âœ… ä¸éœ€è¦åœ¨ Webview å’Œæ‰©å±•ç«¯ä¹‹é—´è½¬æ¢ç›¸å¯¹/ç»å¯¹è·¯å¾„
- âœ… å‡å°‘è·¯å¾„è®¡ç®—çš„å‡ºé”™æ¦‚ç‡
- âœ… ä»£ç æ›´ç®€æ´

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **é‡æ–°åŠ è½½çª—å£**
   ```
   Ctrl+Shift+P â†’ Developer: Reload Window
   ```

2. **æµ‹è¯• node-moved è­¦å‘Šæ¶ˆå¤±**
   - æ‰“å¼€è“å›¾
   - æ‹–æ‹½èŠ‚ç‚¹ç§»åŠ¨ä½ç½®
   - æ£€æŸ¥æ§åˆ¶å°ï¼šä¸åº”å†æœ‰"æœªçŸ¥æ¶ˆæ¯ç±»å‹: node-moved"è­¦å‘Š
   - âœ… é¢„æœŸï¼šä»…è¾“å‡ºè°ƒè¯•æ—¥å¿— `[DEBUG] èŠ‚ç‚¹ç§»åŠ¨: xxx`

3. **æµ‹è¯•æ–‡ä»¶å¤¹ä¸‹é’»**
   - æ‰“å¼€è“å›¾ï¼ˆæ ¹ç›®å½•ï¼‰
   - åŒå‡»ä»»æ„æ–‡ä»¶å¤¹èŠ‚ç‚¹
   - âœ… é¢„æœŸï¼šæˆåŠŸä¸‹é’»åˆ°å­ç›®å½•ï¼Œæ˜¾ç¤ºå­ç›®å½•çš„å†…å®¹

4. **æµ‹è¯•è·¯å¾„æ­£ç¡®æ€§**
   - æŸ¥çœ‹æ—¥å¿—è¾“å‡ºçš„ä¸‹é’»è·¯å¾„
   - âœ… é¢„æœŸï¼šè·¯å¾„æ ¼å¼æ­£ç¡®ï¼Œæ— é‡å¤éƒ¨åˆ†
   - ç¤ºä¾‹ï¼š`ä¸‹é’»åˆ°: D:\rust\active-projects\å°çº¢ä¹¦\employeeGUI\debug`

5. **æµ‹è¯•è¿”å›ä¸Šçº§**
   - ä¸‹é’»åç‚¹å‡»"è¿”å›ä¸Šçº§"æŒ‰é’®
   - âœ… é¢„æœŸï¼šæ­£ç¡®è¿”å›çˆ¶ç›®å½•

### æµ‹è¯•æ¸…å•

- [ ] node-moved è­¦å‘Šæ¶ˆå¤±
- [ ] åŒå‡»æ–‡ä»¶å¤¹æˆåŠŸä¸‹é’»
- [ ] è·¯å¾„æ ¼å¼æ­£ç¡®ï¼ˆæ— é‡å¤ï¼‰
- [ ] è¿”å›ä¸Šçº§åŠŸèƒ½æ­£å¸¸
- [ ] å¯ä»¥è¿ç»­ä¸‹é’»å¤šå±‚
- [ ] å¯ä»¥ä»æ·±å±‚è¿”å›åˆ°æ ¹ç›®å½•

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### è·¯å¾„å­˜å‚¨ç­–ç•¥

**å½“å‰å®ç°**ï¼š
```
FileTreeScanner.scanPathShallow()
  â†“
åˆ›å»ºèŠ‚ç‚¹æ—¶ï¼š
  data.path = childPath  // ç»å¯¹è·¯å¾„ (D:\...\folder)
  â†“
ä¼ é€’åˆ° Webview
  â†“
åŒå‡»ä¸‹é’»ï¼š
  message.payload = nodeData  // åŒ…å« data.path
  â†“
BlueprintPanel.handleNodeDoubleClick()
  â†“
ç›´æ¥ä½¿ç”¨ nodeData.data.path  // å·²ç»æ˜¯ç»å¯¹è·¯å¾„
  â†“
vscode.Uri.file(folderPath)  // âœ… æ­£ç¡®
```

**ä¼˜ç‚¹**ï¼š
- è·¯å¾„åœ¨æ•´ä¸ªæµç¨‹ä¸­ä¿æŒä¸€è‡´ï¼ˆéƒ½æ˜¯ç»å¯¹è·¯å¾„ï¼‰
- ä¸éœ€è¦ç›¸å¯¹/ç»å¯¹è·¯å¾„è½¬æ¢
- å‡å°‘å‡ºé”™æ¦‚ç‡

### æ¶ˆæ¯ç±»å‹å¤„ç†ç­–ç•¥

**åŸåˆ™**ï¼šå³ä½¿ä¸éœ€è¦å¤„ç†çš„æ¶ˆæ¯ï¼Œä¹Ÿåº”è¯¥æ·»åŠ  case åˆ†æ”¯

```typescript
// âŒ ä¸å¥½çš„åšæ³•
default:
    this.logger.warn(`æœªçŸ¥æ¶ˆæ¯ç±»å‹: ${message.type}`);

// âœ… å¥½çš„åšæ³•
case 'node-moved':
    this.logger.debug('èŠ‚ç‚¹ç§»åŠ¨ï¼Œæ— éœ€å¤„ç†');
    break;
case 'some-future-type':
    // é¢„ç•™æ‰©å±•
    break;
default:
    this.logger.warn(`çœŸæ­£æœªçŸ¥çš„æ¶ˆæ¯ç±»å‹: ${message.type}`);
```

---

## ğŸ“ˆ æ–‡ä»¶å˜æ›´ç»Ÿè®¡

```
1 file changed
15 insertions(+)
20 deletions(-)
```

### ä¿®æ”¹çš„æ–‡ä»¶

**BlueprintPanel.ts**ï¼š
1. æ–°å¢ `case 'node-moved'` å¤„ç†ï¼ˆ5 è¡Œï¼‰
2. ç®€åŒ– `handleNodeDoubleClick` æ–¹æ³•ï¼ˆ-20 è¡Œï¼Œ+10 è¡Œï¼‰
   - ç§»é™¤ workspaceRoot è·å–é€»è¾‘
   - ç§»é™¤è·¯å¾„æ‹¼æ¥é€»è¾‘
   - ç›´æ¥ä½¿ç”¨ç»å¯¹è·¯å¾„

---

## ğŸ¯ æ ¹æœ¬åŸå› æ€»ç»“

### é—®é¢˜ 1: æ¶ˆæ¯ç±»å‹æœªæ³¨å†Œ
- **ç—‡çŠ¶**ï¼šè­¦å‘Šæ—¥å¿—ä¸æ–­è¾“å‡º
- **æ ¹å› **ï¼šswitch-case ç¼ºå°‘åˆ†æ”¯
- **ä¿®å¤**ï¼šæ·»åŠ  case 'node-moved'

### é—®é¢˜ 2: è·¯å¾„ç†è§£é”™è¯¯
- **ç—‡çŠ¶**ï¼šä¸‹é’»åè·¯å¾„é‡å¤ï¼Œæ— æ³•æ‰“å¼€
- **æ ¹å› **ï¼šè¯¯ä»¥ä¸º data.path æ˜¯ç›¸å¯¹è·¯å¾„
- **ä¿®å¤**ï¼šè®¤è¯†åˆ° data.path æ˜¯ç»å¯¹è·¯å¾„ï¼Œç›´æ¥ä½¿ç”¨

### æ•™è®­

1. **æ¶ˆæ¯é©±åŠ¨æ¶æ„**ï¼šæ‰€æœ‰å¯èƒ½çš„æ¶ˆæ¯ç±»å‹éƒ½åº”åœ¨ switch ä¸­å¤„ç†
2. **è·¯å¾„ç®¡ç†**ï¼šæ˜ç¡®æ¯ä¸ªè·¯å¾„å˜é‡æ˜¯ç»å¯¹è·¯å¾„è¿˜æ˜¯ç›¸å¯¹è·¯å¾„
3. **æ—¥å¿—è¿½è¸ª**ï¼šä½¿ç”¨æ—¥å¿—è¾“å‡ºè·¯å¾„å€¼ï¼Œå¿«é€Ÿå®šä½æ‹¼æ¥é”™è¯¯
4. **ä»£ç å®¡æŸ¥**ï¼šæ£€æŸ¥è·¯å¾„æ‹¼æ¥é€»è¾‘ï¼Œé¿å…é‡å¤

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ–‡ä»¶å¤¹ä¸‹é’»é—®é¢˜.md](./æ–‡ä»¶å¤¹ä¸‹é’»é—®é¢˜.md) - åŸå§‹é—®é¢˜åˆ†æ
- [è¿æ¥çº¿å±‚çº§ä¿®å¤æ€»ç»“.md](./è¿æ¥çº¿å±‚çº§ä¿®å¤æ€»ç»“.md) - ç›¸å…³ä¿®å¤
- [CHANGELOG.md](./CHANGELOG.md) - ç‰ˆæœ¬å†å²

---

## ğŸ‰ å®Œæˆæ€»ç»“

### âœ… å·²è§£å†³

- node-moved è­¦å‘Šä¸å†å‡ºç°
- æ–‡ä»¶å¤¹ä¸‹é’»åŠŸèƒ½æ­£å¸¸
- è·¯å¾„æ‹¼æ¥é€»è¾‘ç®€åŒ–
- ä»£ç å¯ç»´æŠ¤æ€§æå‡

### ğŸ¯ ç”¨æˆ·ä»·å€¼

1. **äº¤äº’ä½“éªŒ**ï¼šåŒå‡»æ–‡ä»¶å¤¹ç«‹å³å“åº”ï¼Œä¸‹é’»æµç•…
2. **å¤šå±‚å¯¼èˆª**ï¼šæ”¯æŒå¤šå±‚ä¸‹é’»å’Œè¿”å›
3. **æ— å™ªéŸ³æ—¥å¿—**ï¼šä¸å†æœ‰çƒ¦äººçš„è­¦å‘Šä¿¡æ¯

### ğŸ“ åç»­å»ºè®®

**çŸ­æœŸ**ï¼š
- ç”¨æˆ·æµ‹è¯•åé¦ˆ
- éªŒè¯æ·±å±‚ä¸‹é’»ï¼ˆ3+ å±‚ï¼‰
- æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆæ ¹ç›®å½•ã€ç¬¦å·é“¾æ¥ç­‰ï¼‰

**ä¸­æœŸ**ï¼ˆå¯é€‰ï¼‰ï¼š
- é¢åŒ…å±‘å¯¼èˆªä¼˜åŒ–ï¼ˆç‚¹å‡»è·³è½¬åˆ°ä»»æ„å±‚çº§ï¼‰
- å†å²è®°å½•åŠŸèƒ½ï¼ˆå‰è¿›/åé€€ï¼‰
- ä¸‹é’»åŠ¨ç”»æ•ˆæœ

---

**ğŸŠ æ–‡ä»¶å¤¹ä¸‹é’»é—®é¢˜å®Œç¾è§£å†³ï¼**
