# æ–‡ä»¶å¤¹ä¸‹é’»åŠŸèƒ½è°ƒè¯•æŒ‡å—

## ğŸ¯ é¢„æœŸè¡Œä¸º

1. **åŒå‡»å­æ–‡ä»¶å¤¹** â†’ åœ¨åŒä¸€é¢æ¿å†…åˆ·æ–°ï¼Œæ˜¾ç¤ºè¯¥æ–‡ä»¶å¤¹çš„å†…å®¹
2. **åŒå‡»æ ¹èŠ‚ç‚¹** â†’ è¿”å›ä¸Šä¸€çº§æ–‡ä»¶å¤¹

## ğŸ” è°ƒè¯•æ­¥éª¤

### Step 1: é‡æ–°åŠ è½½ VS Code
```
F1 â†’ Developer: Reload Window
```

### Step 2: æ‰“å¼€å¼€å‘è€…å·¥å…·
æ‰“å¼€**ä¸¤ä¸ª**è°ƒè¯•çª—å£ï¼š

#### A. Webview å¼€å‘è€…å·¥å…·ï¼ˆå‰ç«¯ï¼‰
```
F1 â†’ Developer: Open Webview Developer Tools
â†’ åˆ‡æ¢åˆ° Console æ ‡ç­¾
```

#### B. æ‰©å±•ä¸»æœºå¼€å‘è€…å·¥å…·ï¼ˆåç«¯ï¼‰
```
F1 â†’ Developer: Toggle Developer Tools  
â†’ åˆ‡æ¢åˆ° Console æ ‡ç­¾
```

### Step 3: æ‰“å¼€è“å›¾
1. åœ¨ AI èµ„æºç®¡ç†å™¨ä¸­å³é”®ä»»æ„æ–‡ä»¶å¤¹
2. é€‰æ‹©"åœ¨æ­¤æ‰“å¼€è“å›¾"

### Step 4: æµ‹è¯•åŒå‡»
1. **åŒå‡»ä¸€ä¸ªå­æ–‡ä»¶å¤¹**ï¼ˆä¸æ˜¯æ ¹èŠ‚ç‚¹ï¼‰
2. è§‚å¯Ÿä¸¤ä¸ªæ§åˆ¶å°çš„è¾“å‡º

---

## ğŸ“Š é¢„æœŸæ—¥å¿—è¾“å‡º

### âœ… å‰ç«¯ï¼ˆWebview Consoleï¼‰åº”è¯¥çœ‹åˆ°ï¼š
```
[åŒå‡»] å­æ–‡ä»¶å¤¹ï¼Œå‘é€ drill: d:\your-project\subfolder
```

æˆ–è€…ï¼ˆå¦‚æœåŒå‡»æ ¹èŠ‚ç‚¹ï¼‰ï¼š
```
[åŒå‡»] æ ¹èŠ‚ç‚¹ï¼Œå‘é€ drill-up: d:\your-project
```

### âœ… åç«¯ï¼ˆExtension Host Consoleï¼‰åº”è¯¥çœ‹åˆ°ï¼š
```
[INFO] [handleDrill] æ”¶åˆ°ä¸‹é’»è¯·æ±‚, payload: { path: 'd:\\your-project\\subfolder' }
[INFO] [handleDrill] æå–çš„ folderPath: d:\your-project\subfolder
[INFO] ä¸‹é’»åˆ°: d:\your-project\subfolder
[INFO] å¼€å§‹æµ…å±‚æ‰«æ: d:\your-project\subfolder
[INFO] æµ…å±‚æ‰«æå®Œæˆ: X ä¸ªæ–‡ä»¶å¤¹, Y ä¸ªæ–‡ä»¶
[INFO] æ˜¾ç¤ºè“å›¾: subfolder (Z ä¸ªèŠ‚ç‚¹)
[INFO] å·²åˆ·æ–°åˆ°å­ç›®å½•: d:\your-project\subfolder
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: åŒå‡»æ²¡æœ‰ä»»ä½•ååº”

#### æ£€æŸ¥ç‚¹ A: å‰ç«¯æ˜¯å¦å‘é€äº†æ¶ˆæ¯ï¼Ÿ
**æŸ¥çœ‹ Webview Console**ï¼ŒåŒå‡»æ—¶åº”è¯¥æœ‰æ—¥å¿—ï¼š
- âŒ å¦‚æœæ²¡æœ‰æ—¥å¿— â†’ åŒå‡»äº‹ä»¶æ²¡æœ‰ç»‘å®š

**å¯èƒ½åŸå› **ï¼š
1. `n.type` ä¸æ˜¯ `"folder"`
2. `n.data?.path` ä¸ºç©º
3. `graph?.metadata?.graphType` ä¸æ˜¯ `"filetree"`

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ Webview Console ä¸­æ£€æŸ¥èŠ‚ç‚¹æ•°æ®ï¼š
```javascript
// æ‰“å¼€ Webview DevToolsï¼Œåœ¨ Console ä¸­æ‰§è¡Œï¼š
console.log('graph:', graph);
console.log('nodes:', graph.nodes);
```

æŸ¥çœ‹è¾“å‡ºä¸­çš„èŠ‚ç‚¹ï¼š
```javascript
{
  id: "...",
  label: "folder-name",
  type: "folder",  // âœ… å¿…é¡»æ˜¯ "folder"
  position: {x: 100, y: 200},
  data: {
    path: "d:\\project\\folder",  // âœ… å¿…é¡»æœ‰ç»å¯¹è·¯å¾„
    isRoot: false  // å­æ–‡ä»¶å¤¹åº”è¯¥æ˜¯ false
  }
}
```

**åŒæ—¶æ£€æŸ¥ metadata**ï¼š
```javascript
{
  metadata: {
    graphType: "filetree",  // âœ… å¿…é¡»æ˜¯ "filetree"
    ...
  }
}
```

#### æ£€æŸ¥ç‚¹ B: åŒå‡»æ˜¯å¦è¢«æ‹–æ‹½äº‹ä»¶æ‹¦æˆªï¼Ÿ

å¦‚æœä½ æ‹–åŠ¨äº†èŠ‚ç‚¹ï¼Œ`dblclick` äº‹ä»¶å¯èƒ½è¢«æ‹¦æˆªã€‚

**æµ‹è¯•æ–¹æ³•**ï¼š
1. åŒå‡»æ—¶**ä¸è¦ç§»åŠ¨é¼ æ ‡**
2. å¿«é€Ÿè¿ç»­ç‚¹å‡»ä¸¤æ¬¡

å¦‚æœä»ç„¶ä¸è¡Œï¼Œå¯èƒ½æ˜¯æ‹–æ‹½äº‹ä»¶æ‹¦æˆªã€‚è®©æˆ‘æ£€æŸ¥ `makeDraggable` å‡½æ•°ã€‚

---

### é—®é¢˜ 2: å‰ç«¯å‘é€äº†æ¶ˆæ¯ï¼Œä½†åç«¯æ²¡æœ‰ååº”

**æŸ¥çœ‹ Extension Host Console**ï¼š
- âŒ å¦‚æœæ²¡æœ‰çœ‹åˆ° `[handleDrill]` æ—¥å¿—

**å¯èƒ½åŸå› **ï¼š
1. æ¶ˆæ¯ç±»å‹ä¸åŒ¹é…
2. `handleMessage` çš„ switch-case æ²¡æœ‰åŒ¹é…åˆ°

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨åç«¯æ·»åŠ ä¸´æ—¶æ—¥å¿—ï¼ŒæŸ¥çœ‹æ”¶åˆ°çš„åŸå§‹æ¶ˆæ¯ï¼š

```typescript
// åœ¨ handleMessage å‡½æ•°å¼€å¤´
private async handleMessage(message: any): Promise<void> {
    console.log('[handleMessage] æ”¶åˆ°æ¶ˆæ¯:', message);  // æ·»åŠ è¿™è¡Œ
    this.logger.debug(`æ”¶åˆ° Webview æ¶ˆæ¯: ${message.type}`);
    ...
}
```

---

### é—®é¢˜ 3: åç«¯æ”¶åˆ°äº†æ¶ˆæ¯ï¼Œä½†æ‰«æå¤±è´¥

**æŸ¥çœ‹ Extension Host Console**ï¼š
```
[ERROR] ä¸‹é’»å¤±è´¥: ...
```

**å¯èƒ½åŸå› **ï¼š
1. `folderPath` ä¸æ˜¯æœ‰æ•ˆçš„ç»å¯¹è·¯å¾„
2. è·¯å¾„ä¸å­˜åœ¨
3. æ²¡æœ‰è¯»å–æƒé™

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥è·¯å¾„æ ¼å¼ï¼š
```
âœ… æ­£ç¡®: d:\rust\active-projects\ai-explorer\src
âŒ é”™è¯¯: src (ç›¸å¯¹è·¯å¾„)
âŒ é”™è¯¯: /src (POSIX è·¯å¾„)
```

---

### é—®é¢˜ 4: æ‰«ææˆåŠŸï¼Œä½†é¢æ¿æ²¡æœ‰åˆ·æ–°

**æŸ¥çœ‹åç«¯æ—¥å¿—**ï¼š
```
[INFO] å·²åˆ·æ–°åˆ°å­ç›®å½•: ...
```

**å¯èƒ½åŸå› **ï¼š
1. `showGraph` å‡½æ•°æœ‰é—®é¢˜
2. Webview æ²¡æœ‰æ¥æ”¶åˆ° `init-graph` æ¶ˆæ¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ Webview Console ä¸­æ£€æŸ¥æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯ï¼š
```javascript
// åœ¨ handleMessage å‡½æ•°ä¸­åº”è¯¥æœ‰æ—¥å¿—
if (msg?.type === 'init-graph') {
    console.log('[æ”¶åˆ°] init-graph æ¶ˆæ¯:', msg.payload);
    graph = msg.payload;
    ...
}
```

---

## ğŸ”¬ æ·±åº¦è°ƒè¯•

### æ£€æŸ¥èŠ‚ç‚¹çš„ data å±æ€§

åœ¨ Webview Console ä¸­æ‰§è¡Œï¼š
```javascript
// æ‰“å°æ‰€æœ‰æ–‡ä»¶å¤¹èŠ‚ç‚¹
graph.nodes.filter(n => n.type === 'folder').forEach(n => {
    console.log('æ–‡ä»¶å¤¹èŠ‚ç‚¹:', {
        label: n.label,
        path: n.data?.path,
        isRoot: n.data?.isRoot,
        type: n.type
    });
});
```

**é¢„æœŸè¾“å‡º**ï¼š
```javascript
æ–‡ä»¶å¤¹èŠ‚ç‚¹: {
  label: "root-folder",
  path: "d:\\project\\root",
  isRoot: true,
  type: "folder"
}
æ–‡ä»¶å¤¹èŠ‚ç‚¹: {
  label: "subfolder",
  path: "d:\\project\\root\\subfolder",
  isRoot: false,  // âœ… å­æ–‡ä»¶å¤¹å¿…é¡»æ˜¯ false
  type: "folder"
}
```

### æ£€æŸ¥åŒå‡»äº‹ä»¶ç»‘å®š

åœ¨ Webview Console ä¸­æ‰§è¡Œï¼š
```javascript
// æ£€æŸ¥èŠ‚ç‚¹å…ƒç´ 
const folderNodes = document.querySelectorAll('.node');
folderNodes.forEach((el, i) => {
    const id = el.dataset.id;
    const node = graph.nodes.find(n => n.id === id);
    if (node?.type === 'folder') {
        console.log(`èŠ‚ç‚¹ ${i}: ${node.label}`, {
            type: node.type,
            hasPath: !!node.data?.path,
            isRoot: node.data?.isRoot,
            hasListener: el.ondblclick !== null  // æ£€æŸ¥æ˜¯å¦ç»‘å®šäº†äº‹ä»¶
        });
    }
});
```

---

## ğŸ“ è‡ªæ£€æ¸…å•

æµ‹è¯•å‰è¯·ç¡®è®¤ï¼š

- [ ] é‡æ–°åŠ è½½äº† VS Code çª—å£
- [ ] æ‰“å¼€äº† **ä¸¤ä¸ª** å¼€å‘è€…å·¥å…·ï¼ˆWebview + Extension Hostï¼‰
- [ ] æ‰“å¼€äº†è“å›¾é¢æ¿
- [ ] èƒ½çœ‹åˆ°å¤šä¸ªæ–‡ä»¶å¤¹èŠ‚ç‚¹ï¼ˆè‡³å°‘ä¸€ä¸ªæ ¹èŠ‚ç‚¹ + ä¸€ä¸ªå­æ–‡ä»¶å¤¹ï¼‰
- [ ] åŒå‡»æ—¶**ä¸ç§»åŠ¨é¼ æ ‡**ï¼ˆé¿å…è§¦å‘æ‹–æ‹½ï¼‰
- [ ] åŒå‡»çš„æ˜¯**æ–‡ä»¶å¤¹**èŠ‚ç‚¹ï¼ˆä¸æ˜¯æ–‡ä»¶ï¼‰

---

## ğŸ¯ å¿«é€Ÿæ£€æµ‹è„šæœ¬

åœ¨ Webview Console ä¸­æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼Œä¸€é”®æ£€æŸ¥æ‰€æœ‰æ¡ä»¶ï¼š

```javascript
console.log('=== ä¸‹é’»åŠŸèƒ½è¯Šæ–­ ===');
console.log('1. Graph Type:', graph?.metadata?.graphType);  // åº”è¯¥æ˜¯ "filetree"
console.log('2. èŠ‚ç‚¹æ€»æ•°:', graph?.nodes?.length);

const folders = graph.nodes.filter(n => n.type === 'folder');
console.log('3. æ–‡ä»¶å¤¹èŠ‚ç‚¹æ•°:', folders.length);

folders.forEach((n, i) => {
    console.log(`   æ–‡ä»¶å¤¹ ${i}:`, {
        label: n.label,
        hasPath: !!n.data?.path,
        path: n.data?.path,
        isRoot: n.data?.isRoot,
        canDrill: !n.data?.isRoot && !!n.data?.path  // å¯ä¸‹é’»æ¡ä»¶
    });
});

console.log('4. æµ‹è¯•æ–¹æ³•: åŒå‡»ä¸Šé¢ canDrill=true çš„æ–‡ä»¶å¤¹');
console.log('===================');
```

**é¢„æœŸè¾“å‡º**ï¼š
```
=== ä¸‹é’»åŠŸèƒ½è¯Šæ–­ ===
1. Graph Type: filetree
2. èŠ‚ç‚¹æ€»æ•°: 15
3. æ–‡ä»¶å¤¹èŠ‚ç‚¹æ•°: 3
   æ–‡ä»¶å¤¹ 0: {label: 'root', hasPath: true, path: 'd:\\...', isRoot: true, canDrill: false}
   æ–‡ä»¶å¤¹ 1: {label: 'src', hasPath: true, path: 'd:\\...\\src', isRoot: false, canDrill: true}  â† å¯ä»¥åŒå‡»
   æ–‡ä»¶å¤¹ 2: {label: 'docs', hasPath: true, path: 'd:\\...\\docs', isRoot: false, canDrill: true}  â† å¯ä»¥åŒå‡»
4. æµ‹è¯•æ–¹æ³•: åŒå‡»ä¸Šé¢ canDrill=true çš„æ–‡ä»¶å¤¹
===================
```

---

## ğŸ’¡ æœ€å¯èƒ½çš„é—®é¢˜

æ ¹æ®ç»éªŒï¼Œæœ€å¸¸è§çš„é—®é¢˜æ˜¯ï¼š

### 1. **æ‹–æ‹½äº‹ä»¶æ‹¦æˆªäº†åŒå‡»**
- **ç°è±¡**: åŒå‡»èŠ‚ç‚¹ä¼šè½»å¾®ç§»åŠ¨ä½ç½®ï¼Œä½†ä¸ä¸‹é’»
- **åŸå› **: `makeDraggable` å‡½æ•°çš„ `pointermove` äº‹ä»¶æ‹¦æˆªäº† `dblclick`
- **è§£å†³**: åŒå‡»æ—¶å®Œå…¨ä¸è¦ç§»åŠ¨é¼ æ ‡

### 2. **è·¯å¾„æ ¼å¼é”™è¯¯**
- **ç°è±¡**: å‰ç«¯å‘é€æ¶ˆæ¯ï¼Œåç«¯æŠ¥é”™
- **åŸå› **: `n.data.path` ä¸æ˜¯ç»å¯¹è·¯å¾„
- **è§£å†³**: æ£€æŸ¥ FileTreeScanner ç”Ÿæˆçš„è·¯å¾„

### 3. **graphType ä¸åŒ¹é…**
- **ç°è±¡**: åŒå‡»å®Œå…¨æ²¡ååº”
- **åŸå› **: `graph.metadata.graphType !== "filetree"`
- **è§£å†³**: æ£€æŸ¥ scanPathShallow æ˜¯å¦è®¾ç½®äº†æ­£ç¡®çš„ metadata

---

## ğŸ“š ç›¸å…³ä»£ç ä½ç½®

- **å‰ç«¯äº‹ä»¶ç»‘å®š**: `media/filetree-blueprint/graphView.js` è¡Œ 208-230
- **åç«¯æ¶ˆæ¯å¤„ç†**: `src/features/filetree-blueprint/panel/BlueprintPanel.ts` è¡Œ 123-127
- **ä¸‹é’»å®ç°**: `src/features/filetree-blueprint/panel/BlueprintPanel.ts` è¡Œ 203-242
- **èŠ‚ç‚¹æ•°æ®ç”Ÿæˆ**: `src/features/filetree-blueprint/domain/FileTreeScanner.ts` è¡Œ 153-197

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ“ä½œ
2. æ”¶é›†ä¸¤ä¸ªæ§åˆ¶å°çš„å®Œæ•´æ—¥å¿—
3. åœ¨ Webview Console ä¸­è¿è¡Œè¯Šæ–­è„šæœ¬
4. å¦‚æœè¿˜æœ‰é—®é¢˜ï¼ŒæŠŠæ—¥å¿—å’Œè¯Šæ–­ç»“æœå‘ç»™æˆ‘

ç¥è°ƒè¯•é¡ºåˆ©ï¼ğŸ‰
