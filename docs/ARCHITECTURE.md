# æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ—ï¸ æ•´ä½“æ¶æ„

AI Explorer é‡‡ç”¨**åˆ†å±‚æ¨¡å—åŒ–æ¶æ„**ï¼Œç¡®ä¿é«˜å†…èšã€ä½è€¦åˆï¼Œæ”¯æŒæ¨¡å—ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   VS Code Extension                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Layer (TreeView, Webview, Commands)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Application Layer (Use Cases, Services)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Domain Layer (Entities, Ports)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Infrastructure Layer (API, Cache, Storage)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core Layer (DI, Logging, AI Client)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. æ´‹è‘±æ¶æ„ï¼ˆClean Architectureï¼‰

- **å¤–å±‚ä¾èµ–å†…å±‚**ï¼šUI â†’ Application â†’ Domain â† Infrastructure
- **ä¾èµ–åè½¬**ï¼šé€šè¿‡æ¥å£ï¼ˆPortsï¼‰è§£è€¦å…·ä½“å®ç°
- **å•ä¸€èŒè´£**ï¼šæ¯å±‚ä¸“æ³¨è‡ªå·±çš„èŒè´£

### 2. æ¨¡å—è¾¹ç•Œæ¸…æ™°

```typescript
// æ¨¡å—ä¾èµ–å›¾
Core â† Features (Explorer-Alias, UML-Canvas) â† UI
  â†‘
Shared
```

- **ç¦æ­¢è·¨æ¨¡å—ç›´æ¥ä¾èµ–**ï¼šFeatures ä¹‹é—´ä¸èƒ½äº’ç›¸å¯¼å…¥
- **é€šè¿‡ Core å’Œ Shared é€šä¿¡**ï¼šå…±äº«åŠŸèƒ½æ”¾åœ¨ Coreï¼Œå…±äº«ç±»å‹æ”¾åœ¨ Shared

### 3. ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰

æ‰€æœ‰æœåŠ¡é€šè¿‡ DI å®¹å™¨ç®¡ç†ï¼Œæ”¯æŒï¼š
- **å•ä¾‹æ¨¡å¼**ï¼šOpenAI å®¢æˆ·ç«¯ã€ç¼“å­˜æœåŠ¡
- **å·¥å‚æ¨¡å¼**ï¼šç”¨ä¾‹ç±»ã€ä¸šåŠ¡æœåŠ¡  
- **å®ä¾‹æ³¨å…¥**ï¼šVS Code Context

## ğŸ“ ç›®å½•ç»“æ„è¯¦è§£

### Core å±‚ - åŸºç¡€è®¾æ–½

```
src/core/
â”œâ”€â”€ di/
â”‚   â””â”€â”€ Container.ts          # ä¾èµ–æ³¨å…¥å®¹å™¨
â”œâ”€â”€ ai/  
â”‚   â”œâ”€â”€ OpenAIClient.ts       # AI æœåŠ¡ç»Ÿä¸€å…¥å£
â”‚   â””â”€â”€ PromptProfiles.ts     # æç¤ºè¯æ¨¡æ¿ç®¡ç†
â”œâ”€â”€ cache/
â”‚   â””â”€â”€ KVCache.ts           # é”®å€¼ç¼“å­˜æœåŠ¡
â””â”€â”€ logging/
    â””â”€â”€ Logger.ts            # ç»“æ„åŒ–æ—¥å¿—æœåŠ¡
```

**èŒè´£**ï¼š
- ğŸ”Œ AI æœåŠ¡æ¥å…¥å’Œé™æµ
- ğŸ’¾ æ•°æ®ç¼“å­˜å’ŒæŒä¹…åŒ–
- ğŸ“ æ—¥å¿—è®°å½•å’Œè°ƒè¯•
- ğŸ—ï¸ ä¾èµ–æ³¨å…¥å’ŒæœåŠ¡ç®¡ç†

### Features å±‚ - ä¸šåŠ¡æ¨¡å—

#### Explorer-Alias æ¨¡å—

```
src/features/explorer-alias/
â”œâ”€â”€ ExplorerAliasModule.ts    # æ¨¡å—å…¥å£å’Œç”Ÿå‘½å‘¨æœŸ
â”œâ”€â”€ ui/                       # UI è¡¨ç°å±‚
â”‚   â”œâ”€â”€ AIExplorerProvider.ts # TreeView æ•°æ®æä¾›è€…
â”‚   â””â”€â”€ ExplorerTreeItem.ts   # æ ‘èŠ‚ç‚¹å®šä¹‰
â”œâ”€â”€ app/                      # åº”ç”¨é€»è¾‘å±‚
â”‚   â””â”€â”€ usecases/
â”‚       â””â”€â”€ TranslateBatchUseCase.ts  # æ‰¹é‡ç¿»è¯‘ç”¨ä¾‹
â”œâ”€â”€ domain/                   # é¢†åŸŸå±‚ï¼ˆå¾…æ‰©å±•ï¼‰
â”‚   â”œâ”€â”€ entities/            # å®ä½“å®šä¹‰
â”‚   â””â”€â”€ ports/               # æ¥å£å®šä¹‰  
â””â”€â”€ infra/                   # åŸºç¡€è®¾æ–½å±‚ï¼ˆå¾…æ‰©å±•ï¼‰
    â”œâ”€â”€ translators/         # ç¿»è¯‘å™¨å®ç°
    â””â”€â”€ repositories/        # æ•°æ®å­˜å‚¨å®ç°
```

#### UML-Canvas æ¨¡å—

```
src/features/uml-canvas/
â”œâ”€â”€ UMLCanvasModule.ts        # æ¨¡å—å…¥å£å’Œç”Ÿå‘½å‘¨æœŸ
â”œâ”€â”€ app/                      # åº”ç”¨é€»è¾‘å±‚
â”‚   â””â”€â”€ usecases/
â”‚       â””â”€â”€ GenerateUMLUseCase.ts    # UML ç”Ÿæˆç”¨ä¾‹
â”œâ”€â”€ panel/                    # Webview é¢æ¿ç®¡ç†
â”‚   â””â”€â”€ UMLCanvasPanel.ts     # é¢æ¿ç”Ÿå‘½å‘¨æœŸå’Œé€šä¿¡
â”œâ”€â”€ domain/                   # é¢†åŸŸå±‚ï¼ˆå¾…æ‰©å±•ï¼‰
â””â”€â”€ webview/                  # å‰ç«¯èµ„æº
    â””â”€â”€ src/                  # å‰ç«¯æºç ï¼ˆVue/React/Vanillaï¼‰
```

### Shared å±‚ - å…±äº«ç»„ä»¶

```
src/shared/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts             # é€šç”¨ç±»å‹å®šä¹‰
â””â”€â”€ base/
    â””â”€â”€ BaseModule.ts        # æ¨¡å—åŸºç±»
```

## ğŸ”„ æ•°æ®æµå‘

### ç”¨æˆ·äº¤äº’æµ

```mermaid
graph TD
    A[ç”¨æˆ·ç‚¹å‡»å‘½ä»¤] --> B[UI Layer æ¥æ”¶]
    B --> C[è°ƒç”¨ Use Case]
    C --> D[é€šè¿‡ Port è°ƒç”¨æœåŠ¡]
    D --> E[Core å±‚æ‰§è¡Œ]
    E --> F[è¿”å›ç»“æœ]
    F --> G[UI Layer æ›´æ–°æ˜¾ç¤º]
```

### AI è°ƒç”¨æµ

```mermaid
graph TD
    A[Use Case å‘èµ· AI è¯·æ±‚] --> B[æ£€æŸ¥ç¼“å­˜]
    B -->|å‘½ä¸­| C[è¿”å›ç¼“å­˜ç»“æœ]
    B -->|æœªå‘½ä¸­| D[æ„å»ºæç¤ºè¯]
    D --> E[OpenAI Client è°ƒç”¨]
    E --> F[é™æµå’Œé‡è¯•]
    F --> G[è§£æå“åº”]
    G --> H[æ›´æ–°ç¼“å­˜]
    H --> I[è¿”å›ç»“æœ]
```

## ğŸ”Œ æ¥å£è®¾è®¡

### Core æœåŠ¡æ¥å£

```typescript
// AI æœåŠ¡æ¥å£
interface AIRequest {
    prompt: string;
    model?: string;
    temperature?: number;
    maxTokens?: number;
}

interface AIResponse {
    content: string;
    usage?: TokenUsage;
}

// ç¼“å­˜æœåŠ¡æ¥å£  
interface CacheService {
    get<T>(key: string, moduleId: string): Promise<T | null>;
    set<T>(key: string, value: T, ttl?: number, moduleId?: string): Promise<void>;
    delete(key: string, moduleId: string): Promise<void>;
}
```

### æ¨¡å—é—´é€šä¿¡

```typescript
// é€šè¿‡äº‹ä»¶æ€»çº¿ï¼ˆå¯é€‰æ‰©å±•ï¼‰
interface ModuleEvent {
    type: string;
    source: string;
    data: any;
}

// é€šè¿‡å…±äº«æœåŠ¡ï¼ˆå½“å‰æ–¹å¼ï¼‰
// å„æ¨¡å—é€šè¿‡ Core å±‚æœåŠ¡é—´æ¥é€šä¿¡
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†ç­–ç•¥

### åˆ†å±‚é”™è¯¯å¤„ç†

1. **UI å±‚**ï¼šç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
2. **Application å±‚**ï¼šä¸šåŠ¡å¼‚å¸¸åŒ…è£…å’Œé‡è¯•
3. **Infrastructure å±‚**ï¼šæŠ€æœ¯å¼‚å¸¸æ•è·å’Œæ—¥å¿—
4. **Core å±‚**ï¼šç³»ç»Ÿçº§å¼‚å¸¸å’Œå…œåº•å¤„ç†

```typescript
// é”™è¯¯ç±»å‹å®šä¹‰
class AIExplorerError extends Error {
    constructor(
        message: string,
        public code: string,
        public module: string,
        public cause?: Error
    ) {
        super(message);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
throw new AIExplorerError(
    'ç¿»è¯‘æœåŠ¡è°ƒç”¨å¤±è´¥',
    'TRANSLATION_SERVICE_ERROR', 
    'explorer-alias',
    originalError
);
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”

```
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ E2E Tests    â”‚  VS Code Extension Tests
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
   â”‚ Integration    â”‚   Module Integration Tests
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚  Unit Tests      â”‚    Use Cases, Services Tests
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ç‹¬ç«‹æµ‹è¯•

æ¯ä¸ªæ¨¡å—éƒ½åº”è¯¥èƒ½å¤Ÿç‹¬ç«‹æµ‹è¯•ï¼š

```bash
# åªæµ‹è¯• Explorer-Alias æ¨¡å—
npm test -- --testPathPattern=explorer-alias

# åªæµ‹è¯• UML-Canvas æ¨¡å—  
npm test -- --testPathPattern=uml-canvas
```

## ğŸ“ˆ æ€§èƒ½è€ƒè™‘

### 1. æ‡’åŠ è½½

- æ¨¡å—æŒ‰éœ€æ¿€æ´»
- å¤§å‹ä¾èµ–å»¶è¿ŸåŠ è½½
- Webview èµ„æºæŒ‰éœ€åŠ è½½

### 2. ç¼“å­˜ç­–ç•¥

```typescript
// å¤šçº§ç¼“å­˜
Memory Cache (å¿«é€Ÿ) â†’ VS Code Storage (æŒä¹…) â†’ AI API (æ˜‚è´µ)
```

### 3. æ‰¹å¤„ç†ä¼˜åŒ–

```typescript  
// æ‰¹é‡ AI è°ƒç”¨ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚
await aiClient.batchProcess(files, translateFile, batchSize: 3);
```

## ğŸ”® æ‰©å±•è§„åˆ’

### æ–°æ¨¡å—æ·»åŠ 

1. åœ¨ `src/features/` åˆ›å»ºæ–°æ¨¡å—ç›®å½•
2. å®ç° `BaseModule` æ¥å£
3. åœ¨ `extension.ts` æ³¨å†Œæ¨¡å—
4. æ›´æ–° `tsconfig.json` é¡¹ç›®å¼•ç”¨
5. é…ç½® ESLint è¾¹ç•Œè§„åˆ™

### æ–°åŠŸèƒ½ç±»å‹

- ğŸ“Š **ä»£ç åº¦é‡æ¨¡å—**ï¼šä»£ç å¤æ‚åº¦åˆ†æ
- ğŸ” **æ™ºèƒ½æœç´¢æ¨¡å—**ï¼šè¯­ä¹‰åŒ–ä»£ç æœç´¢  
- ğŸ¤– **AI åŠ©æ‰‹æ¨¡å—**ï¼šå¯¹è¯å¼ç¼–ç¨‹åŠ©æ‰‹
- ğŸ“š **æ–‡æ¡£ç”Ÿæˆæ¨¡å—**ï¼šè‡ªåŠ¨ API æ–‡æ¡£ç”Ÿæˆ

---

> ğŸ’¡ **è®¾è®¡å“²å­¦**ï¼šä¿æŒç®€å•ã€ä¿æŒæ¨¡å—åŒ–ã€ä¿æŒå¯æµ‹è¯•æ€§ã€‚æ¯ä¸ªæ¨¡å—éƒ½åº”è¯¥èƒ½å¤Ÿç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ã€ç‹¬ç«‹æµ‹è¯•ã€‚