# åŒå‡»æ–‡ä»¶æ— ååº”é—®é¢˜ - è¯Šæ–­ä¸ä¿®å¤

## é—®é¢˜åˆ†æ

æ ¹æ®ä¹‹å‰åŒå‡»æ–‡ä»¶å¤¹é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ,åŒå‡»æ–‡ä»¶çš„é—®é¢˜åº”è¯¥æ˜¯**ç›¸åŒçš„æ ¹æœ¬åŸå› **:

### å†å²é—®é¢˜å›é¡¾

**åŒå‡»æ–‡ä»¶å¤¹é—®é¢˜çš„æ ¹æœ¬åŸå› **: `FileTreeScanner.ts` ç¼ºå°‘ `graphType: 'filetree'` å…ƒæ•°æ®

```typescript
// âŒ ç¼ºå°‘ graphType å¯¼è‡´æ¡ä»¶æ°¸è¿œä¸æ»¡è¶³
if (graph?.metadata?.graphType === "filetree") {
    // è¿™æ®µä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œ!
}
```

## å½“å‰çŠ¶æ€æ£€æŸ¥

### 1. åç«¯ä»£ç (FileTreeScanner.ts)

âœ… **å·²ä¿®å¤** - ä¸¤ä¸ªæ–¹æ³•éƒ½å·²æ·»åŠ  `graphType`:

**scanPath æ–¹æ³•** (æ·±åº¦æ‰«æ):
```typescript
metadata: {
    graphType: 'filetree', // âœ… å·²æ·»åŠ 
    rootPath: rootUri.fsPath,
    // ...
}
```

**scanPathShallow æ–¹æ³•** (æµ…å±‚æ‰«æ):
```typescript
metadata: {
    graphType: 'filetree', // âœ… å·²æ·»åŠ 
    rootPath: dirUri.fsPath,
    // ...
}
```

### 2. å‰ç«¯ä»£ç (graphView.js)

âœ… **å·²å®ç°** - åŒå‡»æ–‡ä»¶äº‹ä»¶ç»‘å®š:

```javascript
// ç¬¬ 239-257 è¡Œ
if (
    n.type === "file" &&
    n.data?.path &&
    graph?.metadata?.graphType === "filetree"
) {
    el.addEventListener("dblclick", (e) => {
        e.stopPropagation();
        console.log('[åŒå‡»] æ–‡ä»¶ï¼Œè¯·æ±‚åˆ†æ:', n.data.path);
        vscode.postMessage({
            type: "analyze-file",
            payload: {
                path: n.data.path,
                nodeId: n.id,
                position: n.position
            }
        });
    });
}
```

## ğŸ› å¯èƒ½çš„é—®é¢˜

è™½ç„¶ä»£ç çœ‹èµ·æ¥æ­£ç¡®,ä½†å¯èƒ½å­˜åœ¨ä»¥ä¸‹é—®é¢˜:

### é—®é¢˜ 1: Webview ç¼“å­˜

**ç—‡çŠ¶**: ä»£ç å·²æ›´æ–°,ä½† Webview ä»ä½¿ç”¨æ—§çš„ JS æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**:
1. é‡æ–°åŠ è½½ VS Code çª—å£: `Ctrl+Shift+P` â†’ "Developer: Reload Window"
2. æˆ–å…³é—­è“å›¾é¢æ¿,é‡æ–°æ‰“å¼€

### é—®é¢˜ 2: ç¼–è¯‘æœªç”Ÿæ•ˆ

**ç—‡çŠ¶**: TypeScript ç¼–è¯‘äº†,ä½† graphView.js æœªæ›´æ–°(å®ƒä¸æ˜¯ TS æ–‡ä»¶)

**æ£€æŸ¥**: graphView.js æ˜¯ç›´æ¥çš„ JS æ–‡ä»¶,ä¸éœ€è¦ç¼–è¯‘,åº”è¯¥ç«‹å³ç”Ÿæ•ˆ

### é—®é¢˜ 3: èŠ‚ç‚¹ç±»å‹ä¸åŒ¹é…

**ç—‡çŠ¶**: èŠ‚ç‚¹çš„ `type` å­—æ®µå€¼ä¸æ˜¯ `"file"`

**è°ƒè¯•æ­¥éª¤**:
1. æ‰“å¼€å¼€å‘è€…å·¥å…·: `Ctrl+Shift+I`
2. åœ¨ Console ä¸­è¿è¡Œ:
   ```javascript
   console.log('Graph metadata:', graph?.metadata);
   console.log('Sample node:', graph?.nodes?.[0]);
   ```

### é—®é¢˜ 4: äº‹ä»¶è¢«å…¶ä»–ç›‘å¬å™¨æ‹¦æˆª

**ç—‡çŠ¶**: åŒå‡»äº‹ä»¶è¢«æ‹–æ‹½æˆ–å…¶ä»–åŠŸèƒ½æ‹¦æˆª

**æ£€æŸ¥**: åœ¨ graphView.js ä¸­æœç´¢å…¶ä»– `dblclick` ç›‘å¬å™¨

## ğŸ”§ ç«‹å³ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1: å¼ºåˆ¶åˆ·æ–°

```bash
# 1. ç¡®ä¿ç¼–è¯‘
npm run compile

# 2. é‡æ–°åŠ è½½ VS Code
# Ctrl+Shift+P â†’ "Developer: Reload Window"
```

### æ­¥éª¤ 2: å¼€å¯è°ƒè¯•æ¨¡å¼

åœ¨ `graphView.js` å¼€å¤´å¯ç”¨è°ƒè¯•:

```javascript
// æœç´¢è¿™ä¸€è¡Œå¹¶ç¡®ä¿è®¾ç½®ä¸º true
const debugEvents = true;  // â† æ”¹ä¸º true
```

### æ­¥éª¤ 3: æµ‹è¯•å¹¶æŸ¥çœ‹æ—¥å¿—

1. æ‰“å¼€æ–‡ä»¶æ ‘è“å›¾
2. æ‰“å¼€å¼€å‘è€…å·¥å…· (`Ctrl+Shift+I`)
3. åŒå‡»ä¸€ä¸ªæ–‡ä»¶èŠ‚ç‚¹
4. æŸ¥çœ‹ Console è¾“å‡º

**é¢„æœŸæ—¥å¿—**:
```
[åŒå‡»] æ–‡ä»¶ï¼Œè¯·æ±‚åˆ†æ: D:\path\to\file.ts
```

**å¦‚æœæ²¡æœ‰æ—¥å¿—**,è¯´æ˜äº‹ä»¶æœªç»‘å®š,ç»§ç»­ä¸‹ä¸€æ­¥ã€‚

### æ­¥éª¤ 4: æ£€æŸ¥ç»‘å®šæ¡ä»¶

åœ¨å¼€å‘è€…å·¥å…· Console ä¸­è¿è¡Œ:

```javascript
// æ£€æŸ¥ graph metadata
console.log('Graph:', graph);
console.log('GraphType:', graph?.metadata?.graphType);
console.log('Expected:', 'filetree');
console.log('Match:', graph?.metadata?.graphType === 'filetree');

// æ£€æŸ¥æ–‡ä»¶èŠ‚ç‚¹
const fileNodes = graph?.nodes?.filter(n => n.type === 'file');
console.log('File nodes:', fileNodes);
if (fileNodes?.length > 0) {
    const sample = fileNodes[0];
    console.log('Sample file node:', sample);
    console.log('Has path:', !!sample.data?.path);
}
```

## ğŸ¯ æœ€å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ

åŸºäºåŒå‡»æ–‡ä»¶å¤¹é—®é¢˜çš„ç»éªŒ,**æœ€å¯èƒ½çš„åŸå› **æ˜¯:

### åŸå› : ä»£ç å·²æ›´æ–°ä½† Webview æœªåˆ·æ–°

**è§£å†³æ–¹æ¡ˆ**:

1. **å…³é—­æ‰€æœ‰è“å›¾é¢æ¿**
2. **é‡æ–°åŠ è½½ VS Code**: `Ctrl+Shift+P` â†’ "Developer: Reload Window"  
3. **é‡æ–°æ‰“å¼€è“å›¾**
4. **æµ‹è¯•åŒå‡»æ–‡ä»¶**

## ğŸ“Š è¯Šæ–­æ£€æŸ¥æ¸…å•

è¿è¡Œä»¥ä¸‹æ£€æŸ¥:

- [ ] `npm run compile` æ‰§è¡ŒæˆåŠŸ
- [ ] VS Code å·²é‡æ–°åŠ è½½
- [ ] è“å›¾é¢æ¿å·²å…³é—­å¹¶é‡æ–°æ‰“å¼€
- [ ] å¼€å‘è€…å·¥å…·å·²æ‰“å¼€(`Ctrl+Shift+I`)
- [ ] `debugEvents = true` å·²è®¾ç½®
- [ ] Console ä¸­è¿è¡Œ `console.log(graph?.metadata?.graphType)` è¿”å› `'filetree'`
- [ ] Console ä¸­å¯ä»¥çœ‹åˆ°æ–‡ä»¶èŠ‚ç‚¹: `graph.nodes.filter(n => n.type === 'file')`
- [ ] åŒå‡»æ–‡ä»¶æ—¶ Console æœ‰ `[åŒå‡»] æ–‡ä»¶ï¼Œè¯·æ±‚åˆ†æ:` æ—¥å¿—

## ğŸ” æ·±åº¦è°ƒè¯•

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ²¡æ•ˆæœ,æ·»åŠ ä¸´æ—¶è°ƒè¯•ä»£ç :

### åœ¨ graphView.js ç¬¬ 239 è¡Œä¹‹å‰æ·»åŠ :

```javascript
// === ä¸´æ—¶è°ƒè¯•ä»£ç  ===
console.log('[è°ƒè¯•] èŠ‚ç‚¹ç±»å‹:', n.type);
console.log('[è°ƒè¯•] èŠ‚ç‚¹æ•°æ®:', n.data);
console.log('[è°ƒè¯•] Graph metadata:', graph?.metadata);
console.log('[è°ƒè¯•] graphType:', graph?.metadata?.graphType);
console.log('[è°ƒè¯•] æ¡ä»¶æ£€æŸ¥:', {
    isFile: n.type === "file",
    hasPath: !!n.data?.path,
    hasGraphType: graph?.metadata?.graphType === "filetree"
});
// === è°ƒè¯•ä»£ç ç»“æŸ ===

// âœ… åŒå‡»æ–‡ä»¶ï¼šå±•å¼€åˆ†æå¡ç‰‡
if (
    n.type === "file" &&
    n.data?.path &&
    graph?.metadata?.graphType === "filetree"
) {
    console.log('[è°ƒè¯•] è¿›å…¥æ–‡ä»¶åŒå‡»ç»‘å®šé€»è¾‘');
    el.addEventListener("dblclick", (e) => {
        // ...
    });
}
```

## ğŸ’¡ å¤‡ç”¨æ–¹æ¡ˆ: ä¸´æ—¶ç§»é™¤æ¡ä»¶

å¦‚æœå®åœ¨æ‰¾ä¸åˆ°åŸå› ,å¯ä»¥ä¸´æ—¶ç§»é™¤ `graphType` æ£€æŸ¥:

```javascript
// ä¸´æ—¶ä¿®æ”¹:ç§»é™¤ graphType æ£€æŸ¥
if (
    n.type === "file" &&
    n.data?.path
    // graph?.metadata?.graphType === "filetree"  // â† æ³¨é‡Šæ‰
) {
    el.addEventListener("dblclick", (e) => {
        e.stopPropagation();
        console.log('[åŒå‡»] æ–‡ä»¶(æ— graphTypeæ£€æŸ¥)ï¼Œè¯·æ±‚åˆ†æ:', n.data.path);
        vscode.postMessage({
            type: "analyze-file",
            payload: {
                path: n.data.path,
                nodeId: n.id,
                position: n.position
            }
        });
    });
}
```

è¿™æ ·å¯ä»¥å…ˆè®©åŠŸèƒ½å·¥ä½œ,ç„¶åå†è°ƒæŸ¥ä¸ºä»€ä¹ˆ `graphType` æ£€æŸ¥å¤±è´¥ã€‚

## ğŸ“ é¢„æœŸè¡Œä¸º

ä¿®å¤å,åŒå‡»æ–‡ä»¶åº”è¯¥:

1. **Console æ—¥å¿—**: `[åŒå‡»] æ–‡ä»¶ï¼Œè¯·æ±‚åˆ†æ: <æ–‡ä»¶è·¯å¾„>`
2. **å¼¹å‡ºåˆ†æå¡ç‰‡**: æ˜¾ç¤ºæ–‡ä»¶çš„ APIã€ä¾èµ–ã€æ‘˜è¦ç­‰
3. **Tabå¯åˆ‡æ¢**: æ¦‚è§ˆã€APIã€ä¾èµ–ã€è¯æ®
4. **è¯æ®å¯ç‚¹å‡»**: ç‚¹å‡»è¯æ®é“¾æ¥è·³è½¬åˆ°æºç 

## ğŸ‰ æˆåŠŸæ ‡å‡†

- âœ… åŒå‡»æ–‡ä»¶æœ‰ Console æ—¥å¿—
- âœ… åˆ†æå¡ç‰‡æ­£å¸¸æ˜¾ç¤º
- âœ… é™æ€åˆ†æä¿¡æ¯æ­£ç¡®(APIã€ä¾èµ–)
- âœ… å¦‚æœå¯ç”¨ AI,æ˜¾ç¤ºæ¨æ–­å’Œå»ºè®®

---

## ç«‹å³è¡ŒåŠ¨

**ç°åœ¨å°±è¯•è¯•æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆ**:

1. å…³é—­æ‰€æœ‰è“å›¾é¢æ¿
2. `Ctrl+Shift+P` â†’ "Developer: Reload Window"
3. é‡æ–°æ‰“å¼€è“å›¾
4. åŒå‡»ä¸€ä¸ª `.ts` æˆ– `.js` æ–‡ä»¶
5. æŸ¥çœ‹æ˜¯å¦å¼¹å‡ºåˆ†æå¡ç‰‡

å¦‚æœè¿˜æ˜¯ä¸è¡Œ,è¯·åœ¨å¼€å‘è€…å·¥å…· Console ä¸­è¿è¡Œ:
```javascript
console.log('graphType:', graph?.metadata?.graphType);
console.log('æ–‡ä»¶èŠ‚ç‚¹:', graph?.nodes?.filter(n => n.type === 'file').slice(0, 3));
```

æŠŠè¾“å‡ºç»“æœå‘Šè¯‰æˆ‘!
