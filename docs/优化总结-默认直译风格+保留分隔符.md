# ✅ 优化总结：默认直译风格 + 保留分隔符

## 📋 文档要求

根据 `docs/分隔符翻译问题.md`，需要实现：

1. **保留原始分隔符**（`-` `_` `.` 驼峰）
2. **不自动添加中文后缀**（如 `.js` 不要变成"模块"）
3. **默认使用直译风格**（不是自然风格）
4. **新增配置项** `keepOriginalDelimiters`

---

## ✨ 改进内容

### 1. **修改默认配置**（`package.json`）

#### 修改前：
```json
{
  "aiExplorer.alias.style": {
    "default": "natural"  // ❌ 自然风格
  },
  "aiExplorer.alias.appendExtSuffix": {
    "default": true  // ❌ 添加中文后缀
  }
}
```

#### 修改后：
```json
{
  "aiExplorer.alias.style": {
    "default": "literal",  // ✅ 直译风格（默认）
    "description": "... literal=直译（逐词翻译、保持原顺序、保留分隔符）"
  },
  "aiExplorer.alias.keepOriginalDelimiters": {
    "type": "boolean",
    "default": true,  // 🆕 新增配置项
    "description": "直译模式下是否保留原始分隔符（- _ . 驼峰等）"
  },
  "aiExplorer.alias.appendExtSuffix": {
    "default": false,  // ✅ 保留原扩展名（默认）
    "description": "... 默认 false，保留原扩展名"
  }
}
```

### 2. **增强直译构建器**（`LiteralAliasBuilderV2.ts`）

#### 新增功能：
- ✅ 读取 `keepOriginalDelimiters` 配置
- ✅ 读取 `appendExtSuffix` 配置
- ✅ 读取 `literalJoiner` 配置

#### 代码逻辑：
```typescript
// 读取配置
const config = vscode.workspace.getConfiguration('aiExplorer');
const keepOriginalDelimiters = config.get<boolean>('alias.keepOriginalDelimiters', true);
const appendExtSuffix = config.get<boolean>('alias.appendExtSuffix', false);
const literalJoiner = config.get<string>('alias.literalJoiner', '_');

let finalDelims = mappedDelims;
let finalExt = ext;

// 1. 分隔符处理
if (!keepOriginalDelimiters) {
    // 不保留原始分隔符，统一使用 literalJoiner
    finalDelims = mapped.map(() => literalJoiner);
}

// 2. 扩展名处理
if (appendExtSuffix) {
    // 添加中文后缀（脚本、模块、组件等）
    const extSuffix = this.getExtensionSuffix(ext);
    if (extSuffix) {
        mapped[mapped.length - 1] += extSuffix;
        finalExt = '';  // 不保留原扩展名
    }
} else {
    // 保留原扩展名
    finalExt = ext;
}

// 3. 重建别名
const alias = rebuildWithDelimiters(mapped, finalDelims, finalExt, true);
```

#### 新增方法：
```typescript
/**
 * 根据扩展名获取中文后缀
 */
private getExtensionSuffix(ext: string): string {
    const suffixMap: Record<string, string> = {
        'js': '脚本',
        'ts': '模块',
        'tsx': '组件',
        'css': '样式',
        'json': '配置',
        'md': '文档',
        // ... 更多映射
    };
    return suffixMap[ext.toLowerCase()] || '';
}
```

---

## 🎯 预期效果

### 示例1：默认配置（直译 + 保留分隔符 + 保留扩展名）
```
输入: clean-xml-files.js
配置:
  - style: "literal"
  - keepOriginalDelimiters: true
  - appendExtSuffix: false

结果: clean-xml-files.js  (第一次，未知词)
AI补缺: {"clean":"清理", "xml":"XML", "files":"文件"}
结果: 清理-XML-文件.js  ✅ (保留连字符和扩展名)
```

### 示例2：自定义连接符
```
输入: analyze_element_hierarchy.cjs
配置:
  - style: "literal"
  - keepOriginalDelimiters: false
  - literalJoiner: "_"
  - appendExtSuffix: false

结果: 分析_元素_层级.cjs  ✅ (统一使用下划线)
```

### 示例3：添加中文后缀
```
输入: user-profile.ts
配置:
  - style: "literal"
  - keepOriginalDelimiters: true
  - appendExtSuffix: true

结果: 用户-资料模块  ✅ (添加"模块"后缀，去掉.ts)
```

---

## 📝 配置说明

### 完整配置示例：
```json
{
  // 翻译风格（默认：直译）
  "aiExplorer.alias.style": "literal",
  
  // 保留原始分隔符（默认：true）
  "aiExplorer.alias.keepOriginalDelimiters": true,
  
  // 添加中文后缀（默认：false，保留原扩展名）
  "aiExplorer.alias.appendExtSuffix": false,
  
  // 自定义连接符（仅在 keepOriginalDelimiters=false 时生效）
  "aiExplorer.alias.literalJoiner": "_"
}
```

### 三种使用场景：

#### 场景1：死板又快（推荐）⭐⭐⭐
```json
{
  "aiExplorer.alias.style": "literal",
  "aiExplorer.alias.keepOriginalDelimiters": true,
  "aiExplorer.alias.appendExtSuffix": false
}
```
- 结果：`clean-xml-files.js → 清理-XML-文件.js`

#### 场景2：统一下划线
```json
{
  "aiExplorer.alias.style": "literal",
  "aiExplorer.alias.keepOriginalDelimiters": false,
  "aiExplorer.alias.literalJoiner": "_",
  "aiExplorer.alias.appendExtSuffix": false
}
```
- 结果：`clean-xml-files.js → 清理_XML_文件.js`

#### 场景3：中文后缀（简洁）
```json
{
  "aiExplorer.alias.style": "literal",
  "aiExplorer.alias.keepOriginalDelimiters": true,
  "aiExplorer.alias.appendExtSuffix": true
}
```
- 结果：`clean-xml-files.js → 清理-XML-文件脚本`

---

## 🔧 技术细节

### 分隔符保留机制：

1. **分词阶段**（`SplitWithDelimiters.ts`）：
   ```typescript
   splitWithDelimiters("clean-xml-files.js")
   → {
       tokens: ["clean", "xml", "files"],
       delims: ["-", "-", ""],
       ext: "js"
     }
   ```

2. **翻译阶段**（`LiteralAliasBuilderV2.ts`）：
   ```typescript
   mapped = ["清理", "XML", "文件"]
   mappedDelims = ["-", "-", ""]  // 保留原始分隔符
   ```

3. **重建阶段**（`rebuildWithDelimiters`）：
   ```typescript
   result = ""
   for (i = 0; i < mapped.length; i++) {
       result += mapped[i] + delims[i]
   }
   result += "." + ext
   → "清理-XML-文件.js"
   ```

### 配置优先级：
1. `keepOriginalDelimiters=true` → 保留原始分隔符
2. `keepOriginalDelimiters=false` → 使用 `literalJoiner`
3. `appendExtSuffix=true` → 添加中文后缀，去掉原扩展名
4. `appendExtSuffix=false` → 保留原扩展名

---

## 🎉 改进总结

### ✅ 完成项：
1. ✅ 默认配置改为 `style: "literal"`（直译风格）
2. ✅ 新增 `keepOriginalDelimiters` 配置项
3. ✅ 默认保留原扩展名（`appendExtSuffix: false`）
4. ✅ 支持三种翻译模式（保留分隔符/统一连接符/中文后缀）
5. ✅ 扩展名后缀映射（js→脚本、ts→模块、tsx→组件等）

### 🚧 待测试：
- [ ] 重新加载 VS Code
- [ ] 删除旧的学习词典（`.ai/.ai-glossary.literal.learned.json`）
- [ ] 测试翻译结果是否保留分隔符
- [ ] 测试是否保留原扩展名

### 📝 用户操作：
1. **重新加载 VS Code**：`Ctrl+Shift+P` → `Developer: Reload Window`
2. **删除旧记录**：删除 `.ai/.ai-glossary.literal.learned.json`
3. **测试翻译**：右键文件 → `AI 资源管理器：翻译此文件`
4. **预期结果**：`clean-xml-files.js → 清理-XML-文件.js` ✅
