# 腾讯云混元 OpenAI 兼容接口 - 配置指南

## � 重要说明

本项目使用的是**腾讯云「混元大模型」提供的 OpenAI 兼容接口**，而非"元宝 App"的接口。

- ✅ **官方接口**：腾讯云混元 OpenAI 兼容接口（稳定、合规、官方支持）
- ❌ **非官方方案**：抓取元宝 App Cookie 的社区项目（不稳定、可能违规）

## �🔧 配置步骤

### 1. 获取 API 密钥

1. 访问 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 开通 **混元大模型** 服务 ([文档](https://cloud.tencent.com/document/product/1729/111008))
3. 在 **API 密钥管理** 中创建 API Key
4. 复制生成的 API Key（注意：这是专门的 API Key，不是 SecretId/SecretKey）

### 2. 配置 VS Code

打开 VS Code 设置（`Ctrl+,`），搜索 `aiExplorer`，配置以下项：

```json
{
  // 腾讯云混元 API Key（从腾讯云控制台获取）
  "aiExplorer.hunyuanApiKey": "你的API_Key",
  
  // OpenAI 兼容接口端点（官方地址，无需修改）
  "aiExplorer.hunyuanBaseUrl": "https://api.hunyuan.cloud.tencent.com/v1",
  
  // 模型选择（推荐 hunyuan-turbo）
  "aiExplorer.hunyuanModel": "hunyuan-turbo",
  
  // 主提供商（如果 OpenAI 未配置，设为 hunyuan）
  "aiExplorer.provider.primary": "hunyuan",
  
  // 备用提供商
  "aiExplorer.provider.fallback": "none"
}
```

### 3. 可用模型

根据[腾讯云官方文档](https://cloud.tencent.com/document/product/1729/111007)，可用模型包括：

- `hunyuan-turbo`：通用版，推荐使用，性价比高
- `hunyuan-turbos-longtext`：**长文本版**，支持更大上下文窗口，适合批量翻译
- `hunyuan-lite`：轻量版，速度最快，成本最低
- `hunyuan-pro`：专业版，最高质量
- `hunyuan-standard`：标准版（如支持）
- `hunyuan-vision`：多模态版本（如支持图像）

**推荐选择**：
- 批量翻译：`hunyuan-turbos-longtext`（长上下文，一次处理更多文件）
- 日常使用：`hunyuan-turbo`（性价比最佳）
- 快速测试：`hunyuan-lite`（速度优先）

**注意**：具体可用模型以腾讯云控制台为准，不同区域/账号可能有差异。

### 4. API Key 格式

腾讯云混元 OpenAI 兼容接口使用**专用 API Key**，格式类似：

```
hunyuan-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**重要区别**：
- ❌ 不是传统的 `SecretId` + `SecretKey` 组合
- ✅ 是专门用于 OpenAI 兼容接口的独立 API Key
- 📍 在腾讯云控制台 → 混元大模型 → API Key 管理 中创建

## 🔄 OpenAI 兼容性说明

本项目使用标准的 OpenAI SDK（`openai` npm 包），通过切换 `baseURL` 和 `apiKey` 即可在不同提供商间切换：

```typescript
// OpenAI 官方
const client = new OpenAI({
  apiKey: 'sk-xxxxxxxx',
  baseURL: 'https://api.openai.com/v1'
});

// 腾讯云混元（OpenAI 兼容接口）
const client = new OpenAI({
  apiKey: 'hunyuan-xxxxxxxx',
  baseURL: 'https://api.hunyuan.cloud.tencent.com/v1'
});
```

**兼容接口列表**（参考[官方文档](https://cloud.tencent.com/document/product/1729/111007)）：
- ✅ `/v1/chat/completions` - 对话补全
- ✅ `/v1/embeddings` - 向量嵌入
- ✅ Function Calling - 函数调用
- ⚠️ 其他接口需查阅官方文档确认

## ⚠️ 常见问题

### 问题1：翻译失败，显示"回退"

**原因**：
1. ❌ API Key 无效或未正确配置
2. ❌ baseURL 配置错误（必须是官方 OpenAI 兼容接口地址）
3. ❌ 未开通混元大模型服务
4. ❌ 模型名称不正确
5. ❌ 网络连接问题

**解决方案**：
1. 检查 API Key 是否从腾讯云控制台正确复制（不是 SecretId/SecretKey）
2. 确认 baseURL 为 `https://api.hunyuan.cloud.tencent.com/v1`（官方 OpenAI 兼容端点）
3. 在腾讯云控制台确认已开通"混元大模型"服务
4. 确认模型名称（推荐 `hunyuan-turbo`）
5. 检查网络连接，确保可以访问腾讯云 API

### 问题2：提示"提供商不可用"

**解决方案**：
1. 打开 VS Code 开发者工具：`Ctrl+Shift+P` → `Developer: Toggle Developer Tools`
2. 查看 Console 标签页的错误日志
3. 检查是否有 API 认证失败的提示
4. 确认 API Key 是否有效

### 问题3：请求超时

**解决方案**：
1. 检查网络连接
2. 尝试切换到更快的模型（`hunyuan-lite`）
3. 减小批量翻译的 batch size

## 🔍 调试方法

### 方法1：查看服务状态

右键点击文件夹 → `AI Explorer: 服务状态检查`

查看输出：
```json
{
  "AI状态": {
    "hunyuan": {
      "available": true,
      "lastError": undefined
    }
  }
}
```

### 方法2：查看日志

VS Code 输出面板（`Ctrl+Shift+U`）→ 选择 `AI Explorer` 频道

查找类似日志：
```
[hunyuan] 发送请求: model=hunyuan-lite, maxTokens=100
[hunyuan] 请求成功: tokens=45
```

或错误日志：
```
[hunyuan] 请求失败 (尝试 1/3): Invalid API key format
```

## 📊 性能对比（参考）

| 模型 | 速度 | 质量 | 成本 | 推荐场景 |
|------|------|------|------|----------|
| hunyuan-turbo | ⚡⚡⚡ | ⭐⭐⭐ | 💰💰 | **通用推荐** |
| hunyuan-lite | ⚡⚡⚡ | ⭐⭐ | 💰 | 批量翻译 |
| hunyuan-pro | ⚡⚡ | ⭐⭐⭐⭐ | 💰💰💰 | 高质量要求 |

**注意**：具体性能和定价以[腾讯云官方文档](https://cloud.tencent.com/document/product/1729)为准。

## 🔄 降级策略

配置主提供商和备用提供商，实现自动降级：

```json
{
  "aiExplorer.provider.primary": "openai",
  "aiExplorer.provider.fallback": "hunyuan"
}
```

当 OpenAI 不可用时，自动切换到腾讯混元。

## ⚠️ 重要提醒

### 关于"元宝"与"混元"的区别

- **元宝（Yuanbao）**：腾讯的 C 端 AI 助手应用（类似 ChatGPT App），不对外提供官方 API
- **混元（Hunyuan）**：腾讯云的 B 端大模型服务，提供官方 OpenAI 兼容 API 接口

**本项目使用的是"混元"的官方接口，而非"元宝"**。

### 不推荐的方案

GitHub 上有部分项目通过抓取"元宝 App"的 Cookie 来包装成 OpenAI 兼容接口（如 `yuanbao-free-api`），这类方案：
- ❌ 非官方，可能违反服务条款
- ❌ 稳定性无保障，随时可能失效
- ❌ 安全风险（需要暴露个人账号信息）
- ❌ 生产环境不建议使用

**强烈建议使用腾讯云官方的混元 OpenAI 兼容接口**。

## 📚 参考资料

- [混元 OpenAI 兼容接口调用示例](https://cloud.tencent.com/document/product/1729/111007)
- [API Key 管理文档](https://cloud.tencent.com/document/product/1729/111008)
- [腾讯云混元大模型控制台](https://console.cloud.tencent.com/hunyuan)
- [OpenAI SDK 文档](https://github.com/openai/openai-node)

## 📞 技术支持

- 腾讯云文档：https://cloud.tencent.com/document/product/1729
- OpenAI 兼容接口文档：https://cloud.tencent.com/document/product/1729/111007
- API Key 管理：https://cloud.tencent.com/document/product/1729/111008
- 项目问题反馈：GitHub Issues
