# ğŸ› åˆ†éš”ç¬¦ä¸¢å¤±é—®é¢˜è¯Šæ–­æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æè¿°

**ç”¨æˆ·åé¦ˆ**ï¼š
```
è¾“å…¥: clean-outdated-docs.ps1
è¾“å‡º: æ¸…æ´è¿‡æ—¶æ–‡æ¡£ï¼ˆæ¥æºï¼šè¯å…¸ï¼‰
é¢„æœŸ: æ¸…æ´-è¿‡æ—¶-æ–‡æ¡£.ps1 âœ…
```

**é—®é¢˜**ï¼šç¿»è¯‘ç»“æœä¸¢å¤±äº†è¿å­—ç¬¦ `-`å’Œæ‰©å±•å `.ps1`

---

## ğŸ” æ ¹æœ¬åŸå› 

### 1. æ—§ç¼“å­˜å¹²æ‰°

ç¿»è¯‘ç»“æœæ˜¾ç¤º **"æ¥æºï¼šè¯å…¸"**ï¼Œè¯´æ˜æ˜¯ä» **ç¼“å­˜** ä¸­ç›´æ¥è¯»å–çš„ï¼Œè€Œä¸æ˜¯é‡æ–°ç¿»è¯‘ã€‚

**ä»£ç è·¯å¾„**ï¼š
```typescript
// src/features/explorer-alias/app/usecases/EnhancedTranslateBatchUseCase.ts:143
const cached = await this.getCachedTranslation(file.name);
if (cached) {
    return cached;  // âŒ è¿”å›æ—§ç¼“å­˜ï¼ˆä½¿ç”¨æ—§è§„åˆ™ç”Ÿæˆï¼‰
}
```

### 2. ç¼“å­˜ç”Ÿæˆäºé…ç½®ä¿®æ”¹ä¹‹å‰

**æ—¶é—´çº¿**ï¼š
1. **æ—§é…ç½®**ï¼ˆç¼“å­˜ç”Ÿæˆæ—¶ï¼‰ï¼š
   ```json
   {
     "alias.style": "natural",           // è‡ªç„¶é£æ ¼ï¼ˆé‡ç»„è¯­åºï¼‰
     "alias.appendExtSuffix": true,      // æ·»åŠ ä¸­æ–‡åç¼€
     "alias.keepOriginalDelimiters": false  // ä¸ä¿ç•™åˆ†éš”ç¬¦
   }
   ```
   - ç»“æœï¼š`clean-outdated-docs.ps1 â†’ æ¸…æ´è¿‡æ—¶æ–‡æ¡£` âŒ

2. **æ–°é…ç½®**ï¼ˆcommit 492bd12ï¼Œåˆšä¿®æ”¹ï¼‰ï¼š
   ```json
   {
     "alias.style": "literal",                // âœ… ç›´è¯‘é£æ ¼
     "alias.keepOriginalDelimiters": true,    // âœ… ä¿ç•™åˆ†éš”ç¬¦
     "alias.appendExtSuffix": false           // âœ… ä¿ç•™æ‰©å±•å
   }
   ```
   - é¢„æœŸï¼š`clean-outdated-docs.ps1 â†’ æ¸…æ´-è¿‡æ—¶-æ–‡æ¡£.ps1` âœ…

3. **é—®é¢˜**ï¼šç¼“å­˜æœªå¤±æ•ˆï¼Œä»ç„¶è¿”å›æ—§ç»“æœ

---

## âœ… ä»£ç å®ç°æ£€æŸ¥

### 1. **ä¸‰ä¸ªå‘½ä»¤æ˜¯å¦éƒ½èµ°åŒä¸€æ¡ç›´è¯‘ç®¡çº¿ï¼Ÿ**

#### å‘½ä»¤å®šä¹‰ï¼ˆpackage.jsonï¼‰ï¼š
```json
{
  "commands": [
    { "command": "aiExplorer.translate", "title": "ç¿»è¯‘ä¸ºä¸­æ–‡" },
    { "command": "aiExplorer.translateThisFile", "title": "ç¿»è¯‘æ­¤æ–‡ä»¶ï¼ˆä»…æ­¤æ–‡ä»¶ï¼‰" },
    { "command": "aiExplorer.forceAITranslate", "title": "å¼ºåˆ¶ç”¨ AI ç¿»è¯‘æ­¤æ–‡ä»¶" }
  ]
}
```

#### å‘½ä»¤å®ç°ï¼ˆExplorerAliasModule.ts:145-158ï¼‰ï¼š
```typescript
// 1. ç¿»è¯‘ä¸ºä¸­æ–‡ï¼ˆæ ‡å‡†ï¼‰
this.registerCommand(context, 'aiExplorer.translate', async (item) => {
    await this.treeProvider?.translateNode(item);  // âœ… ç»Ÿä¸€ç®¡çº¿
});

// 2. ç¿»è¯‘æ­¤æ–‡ä»¶ï¼ˆä»…æ­¤æ–‡ä»¶ï¼‰
this.registerCommand(context, 'aiExplorer.translateThisFile', async (item) => {
    await this.treeProvider?.translateSingleNode(item);  // âœ… ç»Ÿä¸€ç®¡çº¿
});

// 3. å¼ºåˆ¶ç”¨ AI
this.registerCommand(context, 'aiExplorer.forceAITranslate', async (item) => {
    await this.treeProvider?.forceAITranslate(item);  // âœ… ç»Ÿä¸€ç®¡çº¿
});
```

**ç»“è®º**ï¼šâœ… **ä¸‰ä¸ªå‘½ä»¤éƒ½è°ƒç”¨åŒä¸€ä¸ª `translateUseCase`**

---

### 2. **æ˜¯å¦æ”¯æŒ forceAI å‚æ•°ï¼Ÿ**

#### forceAITranslate å®ç°ï¼ˆAIExplorerProvider.ts:509-580ï¼‰ï¼š
```typescript
async forceAITranslate(input?: any): Promise<void> {
    // 1. æ¸…é™¤ç¼“å­˜
    if (this.cache) {
        const cacheKey = `enhanced-translation:${itemName}`;
        await this.cache.delete(cacheKey);  // âœ… æ¸…é™¤æ—§ç¼“å­˜
    }

    // 2. å¼ºåˆ¶ AI ç¿»è¯‘
    const result = await this.translateUseCase.translateSingle(itemName, {
        forceRefresh: true,  // âœ… è·³è¿‡ç¼“å­˜
        forceAI: true,       // âœ… å¼ºåˆ¶ AIï¼ˆè·³è¿‡è¯å…¸ï¼‰
        enableLearning: true  // âœ… ä¿å­˜åˆ°å­¦ä¹ è¯å…¸
    });
}
```

#### EnhancedTranslateBatchUseCase æ”¯æŒï¼ˆ:488-560ï¼‰ï¼š
```typescript
private async processForceAITranslations(...) {
    // å¿½ç•¥è¯å…¸è¯»å–ï¼Œç›´æ¥è°ƒç”¨ AI
    if (!this.literalBuilderV2 || !this.literalAIFallback || !this.dictionaryResolver) {
        // ...
    }

    // åˆå¹¶æ‰€æœ‰æœªçŸ¥è¯ï¼Œä¸€æ¬¡æ€§è¯·æ±‚ AI
    const aiMappings = await this.literalAIFallback.requestMissingTranslations(
        allUnknownWords,
        files.map(f => f.name)
    );

    // å†™å›å­¦ä¹ è¯å…¸
    if (aiMappings && Object.keys(aiMappings).length > 0) {
        await this.dictionaryResolver.writeBatchLearning(aiMappings);
    }
}
```

**ç»“è®º**ï¼šâœ… **å®Œå…¨æ”¯æŒ forceAI å‚æ•°ï¼Œè·³è¿‡è¯å…¸å’Œç¼“å­˜**

---

### 3. **æ˜¯å¦éƒ½ä¿ç•™åˆ†éš”ç¬¦ï¼Ÿ**

#### LiteralAliasBuilderV2 å®ç°ï¼ˆ:120-156ï¼‰ï¼š
```typescript
// 3. é‡å»ºåˆ«åï¼ˆè¯»å–é…ç½®ï¼‰
const config = vscode.workspace.getConfiguration('aiExplorer');
const keepOriginalDelimiters = config.get<boolean>('alias.keepOriginalDelimiters', true);
const appendExtSuffix = config.get<boolean>('alias.appendExtSuffix', false);
const literalJoiner = config.get<string>('alias.literalJoiner', '_');

let finalDelims = mappedDelims;
let finalExt = ext;

// å¦‚æœä¸ä¿ç•™åŸå§‹åˆ†éš”ç¬¦ï¼Œç»Ÿä¸€ä½¿ç”¨ literalJoiner
if (!keepOriginalDelimiters) {
    finalDelims = mapped.map(() => literalJoiner);  // âŒ ç»Ÿä¸€è¿æ¥ç¬¦
} else {
    // âœ… ä¿ç•™åŸå§‹åˆ†éš”ç¬¦ï¼ˆé»˜è®¤ï¼‰
}

// å¦‚æœå¯ç”¨äº†æ‰©å±•ååç¼€ï¼Œæ·»åŠ ä¸­æ–‡åç¼€
if (appendExtSuffix) {
    const extSuffix = this.getExtensionSuffix(ext);
    if (extSuffix) {
        mapped[mapped.length - 1] += extSuffix;  // âŒ æ·»åŠ åç¼€
        finalExt = '';  // ä¸ä¿ç•™åŸæ‰©å±•å
    }
} else {
    finalExt = ext;  // âœ… ä¿ç•™åŸæ‰©å±•åï¼ˆé»˜è®¤ï¼‰
}

const alias = rebuildWithDelimiters(mapped, finalDelims, finalExt, this.keepExtension);
```

**ç»“è®º**ï¼šâœ… **ä»£ç é€»è¾‘å®Œå…¨æ­£ç¡®ï¼Œæ”¯æŒä¿ç•™åˆ†éš”ç¬¦å’Œæ‰©å±•å**

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ¸…é™¤ç¼“å­˜ï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰

#### é€‰é¡¹Aï¼šä½¿ç”¨"å¼ºåˆ¶ AI ç¿»è¯‘"å‘½ä»¤
1. å³é”®ç‚¹å‡» `clean-outdated-docs.ps1`
2. é€‰æ‹© **"AI èµ„æºç®¡ç†å™¨ï¼šå¼ºåˆ¶ç”¨ AI ç¿»è¯‘æ­¤æ–‡ä»¶"**
3. ç³»ç»Ÿä¼šï¼š
   - âœ… æ¸…é™¤æ—§ç¼“å­˜
   - âœ… è°ƒç”¨ AI ç¿»è¯‘ï¼ˆä¿ç•™åˆ†éš”ç¬¦ï¼‰
   - âœ… ä¿å­˜åˆ°å­¦ä¹ è¯å…¸

**é¢„æœŸç»“æœ**ï¼š
```
è¾“å…¥: clean-outdated-docs.ps1
è¾“å‡º: æ¸…æ´-è¿‡æ—¶-æ–‡æ¡£.ps1 âœ…
```

#### é€‰é¡¹Bï¼šæ‰‹åŠ¨æ¸…é™¤ç¼“å­˜
```powershell
# æ–¹æ³•1ï¼šé€šè¿‡å‘½ä»¤é¢æ¿
Ctrl+Shift+P â†’ "AI èµ„æºç®¡ç†å™¨ï¼šæ¸…é™¤æ­¤èŠ‚ç‚¹ç¼“å­˜"

# æ–¹æ³•2ï¼šåˆ é™¤ç¼“å­˜æ–‡ä»¶ï¼ˆè°¨æ…æ“ä½œï¼‰
Remove-Item -Path ".vscode/.ai-cache/*.json" -Force
```

#### é€‰é¡¹Cï¼šé‡æ–°åŠ è½½ VS Code
```
Ctrl+Shift+P â†’ "Developer: Reload Window"
```

---

### æ–¹æ¡ˆ2ï¼šç¼“å­˜ç‰ˆæœ¬æ§åˆ¶ï¼ˆé•¿æœŸæ–¹æ¡ˆï¼‰

#### é—®é¢˜ï¼š
å½“å‰ç¼“å­˜æ²¡æœ‰ç‰ˆæœ¬å·ï¼Œé…ç½®æ”¹å˜æ—¶æ— æ³•è‡ªåŠ¨å¤±æ•ˆã€‚

#### å»ºè®®å®ç°ï¼š
```typescript
// src/features/explorer-alias/app/usecases/EnhancedTranslateBatchUseCase.ts

private getCacheVersion(): string {
    const config = vscode.workspace.getConfiguration('aiExplorer');
    const style = config.get<string>('alias.style', 'literal');
    const keepDelims = config.get<boolean>('alias.keepOriginalDelimiters', true);
    const appendSuffix = config.get<boolean>('alias.appendExtSuffix', false);
    
    // ç”Ÿæˆé…ç½®å“ˆå¸Œä½œä¸ºç‰ˆæœ¬å·
    return `v2-${style}-${keepDelims}-${appendSuffix}`;
}

private async getCachedTranslation(fileName: string): Promise<TranslationResult | null> {
    const version = this.getCacheVersion();
    const cacheKey = `${this.MODULE_ID}:${version}:${fileName}`;  // ğŸ†• åŒ…å«ç‰ˆæœ¬å·
    const cached = await this.cache.get<TranslationResult>(cacheKey);
    
    // ... å…¶ä»–é€»è¾‘
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… é…ç½®æ”¹å˜æ—¶è‡ªåŠ¨å¤±æ•ˆæ—§ç¼“å­˜
- âœ… é¿å…æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜
- âœ… å‘åå…¼å®¹ï¼ˆæ—§ç¼“å­˜è‡ªç„¶å¤±æ•ˆï¼‰

---

## ğŸ“Š æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹1ï¼šä¿ç•™è¿å­—ç¬¦
```
è¾“å…¥: clean-outdated-docs.ps1
é…ç½®: keepOriginalDelimiters=true, appendExtSuffix=false
é¢„æœŸ: æ¸…æ´-è¿‡æ—¶-æ–‡æ¡£.ps1 âœ…
```

### æµ‹è¯•ç”¨ä¾‹2ï¼šç»Ÿä¸€ä¸‹åˆ’çº¿
```
è¾“å…¥: clean-outdated-docs.ps1
é…ç½®: keepOriginalDelimiters=false, literalJoiner="_"
é¢„æœŸ: æ¸…æ´_è¿‡æ—¶_æ–‡æ¡£.ps1 âœ…
```

### æµ‹è¯•ç”¨ä¾‹3ï¼šæ·»åŠ ä¸­æ–‡åç¼€
```
è¾“å…¥: clean-outdated-docs.ps1
é…ç½®: keepOriginalDelimiters=true, appendExtSuffix=true
é¢„æœŸ: æ¸…æ´-è¿‡æ—¶-æ–‡æ¡£è„šæœ¬ âœ…ï¼ˆå»æ‰.ps1ï¼Œæ·»åŠ "è„šæœ¬"ï¼‰
```

---

## âœ… æ–‡æ¡£åŠŸèƒ½æ£€æŸ¥ç»“æœ

### æ ¹æ® `docs/ä¸‰ä¸ªéƒ½èµ°ç›´è¯‘+AIå…œåº•.md`ï¼š

| è¦æ±‚ | å®ç°çŠ¶æ€ | è¯æ® |
|------|---------|------|
| âœ… å‰ä¸¤ä¸ªèœå•èµ°åŒä¸€æ¡ç›´è¯‘ç®¡çº¿ | âœ… å·²å®ç° | `translateNode` + `translateSingleNode` â†’ åŒä¸€ä¸ª `translateUseCase` |
| âœ… ä¿ç•™åˆ†éš”ç¬¦/æ‰©å±•å | âœ… å·²å®ç° | `LiteralAliasBuilderV2` è¯»å–é…ç½®ï¼Œé»˜è®¤ä¿ç•™ |
| âœ… è¯å…¸åˆ†å±‚ + æœ€é•¿çŸ­è¯­åŒ¹é… | âœ… å·²å®ç° | `DictionaryResolver.matchPhrase()` |
| âœ… AI åªè¡¥ç¼ºè¯ | âœ… å·²å®ç° | `LiteralAIFallback.requestMissingTranslations()` |
| âœ… ç¬¬ä¸‰ä¸ªèœå•ï¼šforceAI æ¨¡å¼ | âœ… å·²å®ç° | `forceAITranslate` è·³è¿‡è¯å…¸ï¼Œæ¸…é™¤ç¼“å­˜ |
| âœ… ä»ä¿æŒç›´è¯‘æ ·å¼ | âœ… å·²å®ç° | `forceAI=true` ä»ç„¶è°ƒç”¨ `LiteralAliasBuilderV2` |
| âœ… å†™å›å­¦ä¹ è¯å…¸ | âœ… å·²å®ç° | `writeBatchLearning()` |

**æ€»ç»“**ï¼šğŸ‰ **ä»£ç å®Œå…¨æ»¡è¶³æ–‡æ¡£è¦æ±‚ï¼**

å”¯ä¸€çš„é—®é¢˜æ˜¯**æ—§ç¼“å­˜å¹²æ‰°**ï¼Œä½¿ç”¨"å¼ºåˆ¶ AI ç¿»è¯‘"å³å¯è§£å†³ã€‚

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### ç«‹å³æ“ä½œï¼ˆç”¨æˆ·ï¼‰ï¼š
1. **é‡æ–°åŠ è½½ VS Code**ï¼š
   ```
   Ctrl+Shift+P â†’ Developer: Reload Window
   ```

2. **æ¸…é™¤æ—§ç¼“å­˜**ï¼ˆå¯é€‰ï¼‰ï¼š
   ```powershell
   Remove-Item .vscode\.ai-cache\*.json -Force
   ```

3. **é‡æ–°ç¿»è¯‘**ï¼š
   - å³é”® `clean-outdated-docs.ps1`
   - é€‰æ‹© **"å¼ºåˆ¶ç”¨ AI ç¿»è¯‘æ­¤æ–‡ä»¶"**
   - éªŒè¯ç»“æœï¼šåº”è¯¥æ˜¯ `æ¸…æ´-è¿‡æ—¶-æ–‡æ¡£.ps1` âœ…

### ä»£ç ä¼˜åŒ–ï¼ˆå¼€å‘è€…ï¼‰ï¼š
1. **å®ç°ç¼“å­˜ç‰ˆæœ¬æ§åˆ¶**ï¼ˆé˜²æ­¢æœªæ¥ç±»ä¼¼é—®é¢˜ï¼‰
2. **æ·»åŠ é…ç½®å˜æ›´ç›‘å¬å™¨**ï¼ˆè‡ªåŠ¨æ¸…é™¤æ—§ç¼“å­˜ï¼‰
3. **å¢å¼ºæ—¥å¿—è¾“å‡º**ï¼ˆæ˜¾ç¤ºç¼“å­˜ç‰ˆæœ¬å’Œé…ç½®çŠ¶æ€ï¼‰

---

## ğŸ“ æ€»ç»“

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| ä¸ºä»€ä¹ˆæ²¡æœ‰ä¿ç•™"-"ï¼Ÿ | æ—§ç¼“å­˜ï¼ˆä½¿ç”¨æ—§é…ç½®ç”Ÿæˆï¼‰ | æ¸…é™¤ç¼“å­˜æˆ–ä½¿ç”¨"å¼ºåˆ¶ AI ç¿»è¯‘" |
| ä»£ç æ˜¯å¦æ»¡è¶³æ–‡æ¡£åŠŸèƒ½ï¼Ÿ | âœ… **å®Œå…¨æ»¡è¶³** | æ— éœ€ä¿®æ”¹ï¼Œåªéœ€æ¸…é™¤æ—§ç¼“å­˜ |
| é»˜è®¤é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ | âœ… **å·²ä¼˜åŒ–**ï¼ˆcommit 492bd12ï¼‰ | `literal` + `keepOriginalDelimiters=true` |

**å…³é”®ç‚¹**ï¼š
- âœ… ä»£ç é€»è¾‘ 100% æ­£ç¡®
- âœ… é…ç½®å·²ç»ä¼˜åŒ–
- âŒ æ—§ç¼“å­˜å¹²æ‰° â† **å”¯ä¸€é—®é¢˜**
- âœ… ä½¿ç”¨"å¼ºåˆ¶ AI ç¿»è¯‘"å³å¯è§£å†³
