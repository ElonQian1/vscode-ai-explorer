# è“å›¾å¡ç‰‡ç³»ç»Ÿå¼€å‘è·¯çº¿å›¾

## äº§å“æ„¿æ™¯
**è¯­ä¹‰ç¼©æ”¾çš„æ–‡ä»¶è“å›¾**ï¼šåŒå‡»æ–‡ä»¶æ—¶ä¸å†æ˜¯æ¨¡æ€æŠ½å±‰ï¼Œè€Œæ˜¯åƒè™šå¹»å¼•æ“è“å›¾é‚£æ ·å±•å¼€ä¸ºå¯æ‹–æ‹½ã€å¯åœé ã€å¸¦Tabçš„å¤§å¡ç‰‡ã€‚å¡ç‰‡ä¹‹é—´è‡ªåŠ¨è…¾æŒªç©ºé—´ï¼Œæ•´ä½“åƒæ€ç»´å¯¼å›¾è¿çº¿å±•ç¤ºä¾èµ–å…³ç³»ï¼ŒAIåˆ†æä¸ç”¨æˆ·å¤‡æ³¨é•¿æœŸç¼“å­˜ã€‚

## é‡Œç¨‹ç¢‘è®¡åˆ’

### M0: è“å›¾å¡ç‰‡åŸºç¡€ (1-2å¤©) ğŸ¯
**ç›®æ ‡**: å½»åº•æ›¿æ¢æ¨¡æ€æ¡†ä¸ºå¯æ‹–æ‹½è“å›¾å¡ç‰‡

#### M0.1: Webviewæ¶æ„é‡æ„
- [x] å›ºå®šä¸‰ä¸ªæ ¸å¿ƒæŒ‚è½½ç‚¹ï¼š`breadcrumb-layer` / `graph-root` / `card-layer`
- [x] ç¡®ä¿åŠ è½½é¡ºåºï¼šanalysisCard â†’ graphView â†’ å…¶ä»–ç»„ä»¶
- [x] ç§»é™¤æ‰€æœ‰å†…è”è„šæœ¬ï¼Œæ»¡è¶³CSPè¦æ±‚

#### M0.2: è“å›¾å¡ç‰‡ç»„ä»¶
- [ ] åˆ›å»º `blueprintCard.js` æ¨¡å— (UMDå¯¼å‡º)
- [ ] æ”¯æŒæ‹–æ‹½ã€å¸é™„ç½‘æ ¼ã€å›ºå®š(pin)åŠŸèƒ½
- [ ] å®ç°Tabç»“æ„ï¼šæ¦‚è§ˆ / ä¾èµ– / AI / å¤‡æ³¨
- [ ] å¡ç‰‡å°ºå¯¸å¯è°ƒæ•´å¹¶è®°å¿†ä½ç½®

#### M0.3: æ¶ˆæ¯å¥‘çº¦åè®®
- [ ] å®šä¹‰æ ‡å‡†æ¶ˆæ¯æ ¼å¼ï¼š`show-analysis-card` / `update-analysis-card`
- [ ] å®ç°ACKç¡®è®¤æœºåˆ¶ï¼šé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±
- [ ] æ”¯æŒå¢é‡æ›´æ–°ï¼šAIç»“æœæµå¼åˆå¹¶ï¼Œä¸è¦†ç›–ç”¨æˆ·å¤‡æ³¨

#### M0.4: èƒ¶å›Šç¼“å­˜ç³»ç»Ÿ
- [ ] å»ºç«‹ `.ai-explorer-cache/filecapsules/` å­˜å‚¨ç›®å½•
- [ ] åŸºäº `contentHash` çš„å¤±æ•ˆæ§åˆ¶
- [ ] ç”¨æˆ·å¤‡æ³¨ç‹¬ç«‹ç‰ˆæœ¬åŒ–ï¼Œæ°¸ä¸ä¸¢å¤±

**éªŒæ”¶æ ‡å‡†**: 
âœ… åŒå‡»æ–‡ä»¶ â†’ å¤§å¡ç‰‡åœ¨ç”»å¸ƒä¸Šå±‚  
âœ… å¡ç‰‡å¯æ‹–æ‹½ï¼Œä¸é®æŒ¡åº•å±‚äº¤äº’  
âœ… AIæ›´æ–°æ— é—ªçƒï¼Œå¢é‡åˆå¹¶  
âœ… å¤‡æ³¨å¯ç¼–è¾‘å¹¶æŒä¹…åŒ–  

### M1: è”åŠ¨å¸ƒå±€ (2-3å¤©)
**ç›®æ ‡**: å¡ç‰‡å±•å¼€æ—¶æ¨å¼€å…¶ä»–èŠ‚ç‚¹ï¼Œå®ç°è‡ªåŠ¨å¸ƒå±€

#### æŠ€æœ¯è¦ç‚¹
- å¼•å…¥ **elkjs** (Eclipse Layout Kernel)
- èŠ‚ç‚¹å°ºå¯¸åŠ¨æ€å˜åŒ–ï¼šå°èŠ‚ç‚¹ â‡„ å¤§å¡ç‰‡
- å±•å¼€è§¦å‘å…¨å›¾é‡æ–°å¸ƒå±€ (reflow)
- å¹³æ»‘åŠ¨ç”»è¿‡æ¸¡

**éªŒæ”¶æ ‡å‡†**: 
âœ… å±•å¼€å¤§å¡ç‰‡æ—¶ï¼Œå‘¨å›´èŠ‚ç‚¹è‡ªåŠ¨"è®©è·¯"  
âœ… æ”¶èµ·å¡ç‰‡æ—¶ï¼ŒèŠ‚ç‚¹å›æµè¡¥å……ç©ºé—´  

### M2: è¯­ä¹‰ç¼©æ”¾ä¸å¤šå¡ (3-4å¤©)
**ç›®æ ‡**: è§†å£ç¼©æ”¾æ—¶æ™ºèƒ½åˆ‡æ¢æ¸²æŸ“ç²’åº¦ï¼Œæ”¯æŒå¤šå¡å¹¶å­˜

#### åŠŸèƒ½ç‰¹æ€§
- L0: ç›®å½•å±‚ / L1: æ–‡ä»¶èŠ‚ç‚¹ / L2: æ–‡ä»¶å¤§å¡ç‰‡ / L3: ç¬¦å·å­å›¾
- è¿œæ™¯æ˜¾ç¤ºå›¾æ ‡+æ–‡ä»¶åï¼Œè¿‘æ™¯å±•ç¤ºè¯¦ç»†ä¿¡æ¯
- å¤šå¡ç‰‡ç®¡ç†ï¼š"å¯¹é½ç½‘æ ¼" / "æ•´ç†å¸ƒå±€" / "åªæ˜¾ç¤ºå›ºå®šå¡ç‰‡"

### M3: åˆ†æèƒ¶å›Šå®Œå–„ (2-3å¤©)
**ç›®æ ‡**: å®Œæ•´çš„ç¼“å­˜å¤±æ•ˆæœºåˆ¶å’Œæ•°æ®ç»“æ„

#### æ•°æ®æ¨¡å‹
```typescript
type Capsule = {
  path: string;
  contentHash: string;        // æ–‡ä»¶å†…å®¹å“ˆå¸Œ
  static?: { summary, exports, deps };
  ai?: { inferences, suggestions, lastModel };
  notes?: { md, updatedAt, author };
  version: number;
}
```

### M4: å…³ç³»å¢å¼ºä¸è§†å›¾ (3-4å¤©)
**ç›®æ ‡**: ä¾èµ–å…³ç³»å¯è§†åŒ–å’Œäº¤äº’å¢å¼º

#### è¿çº¿ç³»ç»Ÿ
- æ­£äº¤/åˆ†å±‚è¿çº¿ (UEé£æ ¼)
- ç«¯å£åŒºåˆ†è¾“å…¥/è¾“å‡º
- è·¯å¾„å¯¼è§ˆï¼šæ²¿çº¿åŠ¨ç”»è¿½è¸ª
- ä¾èµ–è¿‡æ»¤ï¼šæŒ‰å±‚çº§/ä½œç”¨åŸŸ

### M5: æ€§èƒ½ä¼˜åŒ– (2-3å¤©)
**ç›®æ ‡**: æ”¯æŒå¤§å‹é¡¹ç›®ï¼Œæµç•…äº¤äº’

#### æŠ€æœ¯æ–¹æ¡ˆ
- èŠ‚ç‚¹>500æ—¶åˆ‡æ¢WebGL (PixiJS)
- è§†å›¾è™šæ‹ŸåŒ– (ä»…æ¸²æŸ“å¯è§åŒºåŸŸ)
- æ¶ˆæ¯å»æŠ–æ‰¹é‡å¤„ç†
- å†…å­˜ç®¡ç†å’Œæ¸²æŸ“ä¼˜åŒ–

### M6: MCPä»£ç†æ¥å…¥ (4-5å¤©)
**ç›®æ ‡**: AIåŠ©æ‰‹é›†æˆï¼Œæ™ºèƒ½ä»£ç åˆ†æ

#### AIåŠŸèƒ½
- "è¯·AIè§£é‡Šè¯¥æ–‡ä»¶ç»™æ–°åŒå­¦"
- "æŒ‰ä¾èµ–ç”Ÿæˆè¯»ä»£ç é¡ºåº"
- "ç”Ÿæˆå•æµ‹è‰æ¡ˆ/ç”¨ä¾‹çŸ©é˜µ"
- åˆ†æç»“æœç›´æ¥å†™å…¥å¤‡æ³¨æˆ–å»ºè®®

### M7: ä½“éªŒæ‰“ç£¨ (2-3å¤©)
**ç›®æ ‡**: å®Œå–„çš„ç”¨æˆ·ä½“éªŒå’Œå·¥ä½œæµ

#### æœ€ç»ˆç‰¹æ€§
- å¡ç‰‡ä¸»é¢˜å’Œå¿«æ·é”® (Oå±•å¼€/På›ºå®š/Spaceèšç„¦)
- å¯¼å‡ºPNG/PDFåŠŸèƒ½
- å·¥ä½œåŒºå…±äº«ç¬”è®°
- å®Œæ•´æ–‡æ¡£å’Œç¤ºä¾‹

## Gitæäº¤ç­–ç•¥

### åˆ†æ”¯å‘½å
- `feature/blueprint-card-system` - ä¸»å¼€å‘åˆ†æ”¯
- `feat/m0-webview-refactor` - M0å…·ä½“åŠŸèƒ½åˆ†æ”¯
- `feat/m1-elkjs-layout` - M1å…·ä½“åŠŸèƒ½åˆ†æ”¯

### æäº¤è§„èŒƒ
```
feat(M0.1): é‡æ„Webviewä¸‰å±‚æŒ‚è½½æ¶æ„

- å›ºå®šbreadcrumb-layer/graph-root/card-layeræŒ‚è½½ç‚¹
- ç§»é™¤å†…è”è„šæœ¬ï¼Œæ»¡è¶³CSPè¦æ±‚
- ç¡®ä¿analysisCardâ†’graphViewåŠ è½½é¡ºåº

closes #issue-number
```

### é‡Œç¨‹ç¢‘æäº¤
æ¯ä¸ªM0.xå®Œæˆåç«‹å³æäº¤ï¼Œä¾¿äºéœ€æ±‚æ–¹è·Ÿè¸ªè¿›åº¦ï¼š
- `git add . && git commit -m "feat(M0.1): å®ŒæˆWebviewæ¶æ„é‡æ„"`
- `git push origin feature/blueprint-card-system`

## æŠ€æœ¯å†³ç­–è®°å½•

### æ¸²æŸ“å¼•æ“é€‰æ‹©
- **SVG**: <300èŠ‚ç‚¹ï¼Œå¼€å‘ç®€å•ï¼ŒCSSæ ·å¼ä¸°å¯Œ
- **PixiJS**: >300èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¼˜ç§€ï¼ŒWebGLåŠ é€Ÿ
- **å†³ç­–**: M0-M2ä½¿ç”¨SVGå¿«é€Ÿè¿­ä»£ï¼ŒM5åˆ‡æ¢PixiJSä¼˜åŒ–

### çŠ¶æ€ç®¡ç†
- **å€™é€‰**: Zustand / Redux / åŸç”ŸçŠ¶æ€
- **å†³ç­–**: ä½¿ç”¨Zustand (è½»é‡ã€TypeScriptå‹å¥½ã€å­¦ä¹ æˆæœ¬ä½)

### å¸ƒå±€å¼•æ“
- **å€™é€‰**: D3-force / Cytoscape / elkjs
- **å†³ç­–**: elkjs (UEè“å›¾é£æ ¼ã€æ”¯æŒæ­£äº¤è¿çº¿ã€å¤„ç†ä¸åŒå°ºå¯¸èŠ‚ç‚¹)

---

## å¼€å‘ç¯å¢ƒå‡†å¤‡

### ä¾èµ–å®‰è£…
```bash
npm install --save elkjs zustand
npm install --save-dev @types/elkjs
```

### ç›®å½•ç»“æ„
```
media/filetree-blueprint/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ blueprintCard.js        # è“å›¾å¡ç‰‡ç»„ä»¶ (æ–°å¢)
â”‚   â”œâ”€â”€ layoutEngine.js         # elkjså¸ƒå±€å¼•æ“ (æ–°å¢)
â”‚   â”œâ”€â”€ capsuleService.js       # èƒ¶å›Šç¼“å­˜æœåŠ¡ (æ–°å¢)
â”‚   â””â”€â”€ analysisCard.js         # ç°æœ‰åˆ†æå¡ç‰‡ (é‡æ„)
â”œâ”€â”€ contracts/
â”‚   â””â”€â”€ messageContracts.js     # æ¶ˆæ¯å¥‘çº¦å®šä¹‰ (æ–°å¢)
â””â”€â”€ graphView.js                # ä¸»è§†å›¾æ§åˆ¶å™¨ (å¢å¼º)
```

---

*æœ€åæ›´æ–°: 2024-10-19*  
*å½“å‰é‡Œç¨‹ç¢‘: M0 - è“å›¾å¡ç‰‡åŸºç¡€*