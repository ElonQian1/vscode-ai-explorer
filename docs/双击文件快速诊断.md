# ğŸ” åŒå‡»æ–‡ä»¶åŠŸèƒ½ - å¿«é€Ÿè¯Šæ–­æŒ‡å—

## ç«‹å³æµ‹è¯•æ­¥éª¤

### 1. é‡æ–°åŠ è½½ VS Code

```
Ctrl+Shift+P â†’ è¾“å…¥ "reload" â†’ é€‰æ‹© "Developer: Reload Window"
```

### 2. æ‰“å¼€æ–‡ä»¶æ ‘è“å›¾

- å³é”®ç‚¹å‡»ä»»æ„æ–‡ä»¶å¤¹
- é€‰æ‹© "ç”Ÿæˆæ–‡ä»¶æ ‘è“å›¾"

### 3. æ‰“å¼€å¼€å‘è€…å·¥å…·

```
Ctrl+Shift+I
```

æˆ–è€…:
```
Ctrl+Shift+P â†’ è¾“å…¥ "dev tools" â†’ é€‰æ‹© "Developer: Toggle Developer Tools"
```

### 4. æŸ¥çœ‹è¯Šæ–­æ—¥å¿—

ç°åœ¨ä»£ç å·²æ·»åŠ è¯Šæ–­æ—¥å¿—,å½“è“å›¾åŠ è½½æ—¶,Console ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶èŠ‚ç‚¹çš„æ£€æŸ¥ç»“æœ:

```
[è¯Šæ–­] æ–‡ä»¶èŠ‚ç‚¹ "package.json": {
    nodeType: "file",
    hasPath: true,
    graphType: "filetree",
    expectedGraphType: "filetree",
    graphTypeMatch: true,
    willBindDoubleClick: true  // â† è¿™ä¸ªåº”è¯¥æ˜¯ true!
}
```

### 5. åŒå‡»ä¸€ä¸ªæ–‡ä»¶

- åœ¨è“å›¾ä¸­æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶èŠ‚ç‚¹(ğŸ“„å›¾æ ‡)
- åŒå‡»å®ƒ

**é¢„æœŸ Console è¾“å‡º**:
```
[ç»‘å®š] ä¸ºæ–‡ä»¶ "xxx.ts" ç»‘å®šåŒå‡»äº‹ä»¶
[åŒå‡»] æ–‡ä»¶ï¼Œè¯·æ±‚åˆ†æ: D:\path\to\file.ts
```

## ğŸ› é—®é¢˜æ’æŸ¥

### æƒ…å†µ A: æ²¡æœ‰çœ‹åˆ° `[è¯Šæ–­]` æ—¥å¿—

**åŸå› **: Webview ç¼“å­˜äº†æ—§ä»£ç 

**è§£å†³**:
1. å…³é—­æ‰€æœ‰è“å›¾é¢æ¿
2. `Ctrl+Shift+P` â†’ "Developer: Reload Window"
3. é‡æ–°æ‰“å¼€è“å›¾
4. é‡æ–°æ‰“å¼€å¼€å‘è€…å·¥å…·

### æƒ…å†µ B: çœ‹åˆ° `willBindDoubleClick: false`

æ£€æŸ¥æ—¥å¿—ä¸­çš„å…·ä½“åŸå› :

#### B1: `graphType` ä¸æ˜¯ `"filetree"`

```javascript
{
    graphType: undefined,  // â† é—®é¢˜!
    graphTypeMatch: false,
    willBindDoubleClick: false
}
```

**è§£å†³**:
- åç«¯ä»£ç æœªç¼–è¯‘æˆ–æœªç”Ÿæ•ˆ
- è¿è¡Œ `npm run compile`
- é‡æ–°åŠ è½½ VS Code

#### B2: `hasPath: false`

```javascript
{
    nodeType: "file",
    hasPath: false,  // â† é—®é¢˜!
    willBindDoubleClick: false
}
```

**è§£å†³**:
- èŠ‚ç‚¹æ•°æ®ç¼ºå°‘ `path` å­—æ®µ
- æ£€æŸ¥ FileTreeScanner.ts çš„èŠ‚ç‚¹åˆ›å»ºé€»è¾‘

#### B3: `nodeType` ä¸æ˜¯ `"file"`

```javascript
{
    nodeType: "document",  // â† é—®é¢˜!
    willBindDoubleClick: false
}
```

**è§£å†³**:
- èŠ‚ç‚¹ç±»å‹è®¾ç½®é”™è¯¯
- æ£€æŸ¥ FileTreeScanner.ts ç¡®ä¿æ–‡ä»¶èŠ‚ç‚¹ `type: 'file'`

### æƒ…å†µ C: `willBindDoubleClick: true` ä½†åŒå‡»æ²¡ååº”

**å¯èƒ½åŸå› **:
1. äº‹ä»¶è¢«å…¶ä»–ç›‘å¬å™¨æ‹¦æˆª
2. æ‹–æ‹½åŠŸèƒ½å¹²æ‰°

**ä¸´æ—¶è§£å†³**: åœ¨ Console ä¸­è¿è¡Œ:
```javascript
// æ‰‹åŠ¨è§¦å‘åˆ†æ
vscode.postMessage({
    type: "analyze-file",
    payload: { path: "D:\\ä½ çš„æ–‡ä»¶è·¯å¾„.ts" }
});
```

### æƒ…å†µ D: çœ‹åˆ° `[åŒå‡»]` æ—¥å¿—ä½†æ²¡æœ‰å¡ç‰‡

**åŸå› **: åç«¯æ¶ˆæ¯å¤„ç†é—®é¢˜

**æ£€æŸ¥**:
1. BlueprintPanel.ts æ˜¯å¦å¤„ç† `analyze-file` æ¶ˆæ¯
2. FileAnalysisService æ˜¯å¦æˆåŠŸåˆå§‹åŒ–
3. æŸ¥çœ‹ VS Code è¾“å‡ºé¢æ¿çš„é”™è¯¯æ—¥å¿—

## ğŸ“Š å®Œæ•´è¯Šæ–­ä¿¡æ¯

åœ¨ Console ä¸­è¿è¡Œ:

```javascript
// 1. æ£€æŸ¥ graph å¯¹è±¡
console.log('=== Graph ä¿¡æ¯ ===');
console.log('Graph:', graph);
console.log('GraphType:', graph?.metadata?.graphType);
console.log('Nodes count:', graph?.nodes?.length);

// 2. æ£€æŸ¥æ–‡ä»¶èŠ‚ç‚¹
console.log('\n=== æ–‡ä»¶èŠ‚ç‚¹ ===');
const fileNodes = graph?.nodes?.filter(n => n.type === 'file');
console.log('æ–‡ä»¶èŠ‚ç‚¹æ•°é‡:', fileNodes?.length);
if (fileNodes?.length > 0) {
    console.log('ç¤ºä¾‹æ–‡ä»¶èŠ‚ç‚¹:', fileNodes[0]);
    console.log('æœ‰ path:', !!fileNodes[0].data?.path);
}

// 3. æ£€æŸ¥æ–‡ä»¶å¤¹èŠ‚ç‚¹
console.log('\n=== æ–‡ä»¶å¤¹èŠ‚ç‚¹ ===');
const folderNodes = graph?.nodes?.filter(n => n.type === 'folder');
console.log('æ–‡ä»¶å¤¹èŠ‚ç‚¹æ•°é‡:', folderNodes?.length);
if (folderNodes?.length > 0) {
    console.log('ç¤ºä¾‹æ–‡ä»¶å¤¹èŠ‚ç‚¹:', folderNodes[0]);
}

// 4. æ£€æŸ¥åŒå‡»äº‹ä»¶ç»‘å®š
console.log('\n=== äº‹ä»¶æ£€æŸ¥ ===');
const fileElements = document.querySelectorAll('.node');
console.log('èŠ‚ç‚¹å…ƒç´ æ•°é‡:', fileElements.length);

// 5. æµ‹è¯•æ¡ä»¶
console.log('\n=== æ¡ä»¶æµ‹è¯• ===');
if (fileNodes?.length > 0) {
    const n = fileNodes[0];
    console.log('æ¡ä»¶ 1 - nodeType === "file":', n.type === "file");
    console.log('æ¡ä»¶ 2 - hasPath:', !!n.data?.path);
    console.log('æ¡ä»¶ 3 - graphType === "filetree":', graph?.metadata?.graphType === "filetree");
    console.log('ç»¼åˆç»“æœ:', n.type === "file" && !!n.data?.path && graph?.metadata?.graphType === "filetree");
}
```

## âœ… æˆåŠŸæ ‡å‡†

è¿è¡Œä¸Šé¢çš„è¯Šæ–­ä»£ç å,åº”è¯¥çœ‹åˆ°:

```javascript
=== Graph ä¿¡æ¯ ===
GraphType: "filetree"  // âœ… å¿…é¡»æ˜¯ "filetree"
Nodes count: 20

=== æ–‡ä»¶èŠ‚ç‚¹ ===
æ–‡ä»¶èŠ‚ç‚¹æ•°é‡: 15
ç¤ºä¾‹æ–‡ä»¶èŠ‚ç‚¹: {
    id: "...",
    type: "file",  // âœ… å¿…é¡»æ˜¯ "file"
    data: {
        path: "D:\\..."  // âœ… å¿…é¡»æœ‰è·¯å¾„
    }
}
æœ‰ path: true  // âœ… å¿…é¡»æ˜¯ true

=== æ¡ä»¶æµ‹è¯• ===
æ¡ä»¶ 1 - nodeType === "file": true  // âœ…
æ¡ä»¶ 2 - hasPath: true  // âœ…
æ¡ä»¶ 3 - graphType === "filetree": true  // âœ…
ç»¼åˆç»“æœ: true  // âœ… æœ€é‡è¦!
```

## ğŸ¯ ä¸‹ä¸€æ­¥

### å¦‚æœæ‰€æœ‰æ¡ä»¶éƒ½æ˜¯ `true` ä½†åŒå‡»ä»æ— æ•ˆ

æ·»åŠ æ›´å¤šè°ƒè¯•:

```javascript
// åœ¨ graphView.js ä¸­æ‰¾åˆ°æ–‡ä»¶åŒå‡»éƒ¨åˆ†,æ”¹ä¸º:
if (
    n.type === "file" &&
    n.data?.path &&
    graph?.metadata?.graphType === "filetree"
) {
    console.log(`âœ… ä¸ºæ–‡ä»¶ "${n.label}" ç»‘å®šåŒå‡»äº‹ä»¶`);
    
    // æ·»åŠ æµ‹è¯•ç‚¹å‡»äº‹ä»¶
    el.addEventListener("click", () => {
        console.log(`ğŸ‘† å•å‡»æ–‡ä»¶: ${n.label}`);
    });
    
    el.addEventListener("dblclick", (e) => {
        console.log(`ğŸ–±ï¸ æ•è·åŒå‡»äº‹ä»¶! æ–‡ä»¶: ${n.label}`);
        e.stopPropagation();
        console.log('[åŒå‡»] æ–‡ä»¶ï¼Œè¯·æ±‚åˆ†æ:', n.data.path);
        vscode.postMessage({
            type: "analyze-file",
            payload: {
                path: n.data.path,
                nodeId: n.id,
                position: n.position
            }
        });
    });
}
```

### å¦‚æœ `graphType` ä¸æ˜¯ `"filetree"`

1. æ£€æŸ¥ç¼–è¯‘: `npm run compile`
2. æ£€æŸ¥ `FileTreeScanner.ts` ç¬¬107è¡Œå’Œç¬¬242è¡Œ
3. åº”è¯¥éƒ½æœ‰: `graphType: 'filetree',`
4. é‡æ–°åŠ è½½ VS Code

## ğŸ“ æŠ¥å‘Šé—®é¢˜æ—¶æä¾›

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨,è¯·æä¾›:

1. Console ä¸­è¿è¡Œè¯Šæ–­ä»£ç çš„å®Œæ•´è¾“å‡º
2. `[è¯Šæ–­]` æ—¥å¿—çš„æˆªå›¾
3. åŒå‡»æ—¶æ˜¯å¦æœ‰ä»»ä½•æ—¥å¿—
4. FileTreeScanner.ts ç¬¬100-110è¡Œçš„ä»£ç æˆªå›¾

---

**ç°åœ¨å°±å¼€å§‹æµ‹è¯•å§!æŒ‰ç…§æ­¥éª¤1-5æ‰§è¡Œ,æŸ¥çœ‹ Console è¾“å‡º!** ğŸš€
